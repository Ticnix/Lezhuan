{"version":3,"file":"Waterfall-one.js","sources":["components/Waterfall-one.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniComponent:/QzovVXNlcnMvODYxMzMvRGVza3RvcC9kZW1vL0xlemh1YW4vY29tcG9uZW50cy9XYXRlcmZhbGwtb25lLnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"waterfall-container\">\n    <!-- 第一列：固定显示一张无文字图片 -->\n    <view class=\"waterfall-column\" :style=\"{ width: columnWidth }\">\n      <view class=\"waterfall-item fixed-first-item\" :style=\"{ marginBottom: gap + 'rpx' }\">\n        <image\n          class=\"waterfall-img\"\n          src=\"https://api.shaolezhuan.cn/lzphoto/command.jpg\"  \n          mode=\"widthFix\"\n          alt=\"固定推荐图片\"\n          :style=\"{ borderRadius: `${borderRadius}rpx` }\"\n        />\n      </view>\n      \n      <!-- 第一列的其他瀑布流项目 -->\n      <view\n        class=\"waterfall-item\"\n        v-for=\"item in firstColumnItems\"\n        :key=\"item.id\"\n        :style=\"{ marginBottom: gap + 'rpx' }\"\n        @click=\"goToDetail(item.id,item.type)\"\n      >\n        <image\n          class=\"waterfall-img\"\n          :src=\"item.imgUrl\"\n          mode=\"widthFix\"\n          :alt=\"item.title\"\n          @load=\"handleImageLoad($event, item, 0)\"\n          @error=\"handleImageError(item)\"\n          :style=\"{ borderRadius: `${borderRadius}rpx ${borderRadius}rpx 0 0` }\"\n        />\n        \n        <view class=\"waterfall-content\" :style=\"{ padding: `${contentPadding}rpx` }\">\n          <!-- 标签区域 -->\n          <view class=\"tags\" v-if=\"item.tags && item.tags.length > 0\">\n            <view class=\"tag-view\" v-for=\"(tag, index) in item.tags\" :key=\"index\">\n              <uni-tag \n                size=\"mini\"\n                :text=\"tag\" \n                :type=\"getTagType(tag)\" \n              />\n            </view>\n          </view>\n          \n          <text \n            class=\"waterfall-title\" \n            :style=\"{ fontSize: `${titleSize}rpx`, marginTop: `${titleMarginTop}rpx` }\"\n          >\n            {{ item.title }}\n          </text>\n          \n          <!-- 价格信息 -->\n          <text \n            class=\"price-text\"\n            :style=\"{ \n              fontSize: `${priceSize}rpx`, \n              marginTop: `${priceMarginTop}rpx`,\n              color: priceColor\n            }\"\n          >\n            {{ item.type === '出物' ? '￥' : '￥' }}{{ item.price }}\n          </text>\n          \n          <!-- 用户信息区域 -->\n          <view class=\"user-info\" :style=\"{ marginTop: `${userInfoMarginTop}rpx` }\">\n            <image \n              class=\"user-avatar\" \n              :src=\"item.user?.avatar\" \n              :style=\"{ \n                width: `${avatarSize}rpx`, \n                height: `${avatarSize}rpx`, \n                borderRadius: `${avatarSize / 2}rpx` \n              }\"\n              mode=\"widthFix\"\n            />\n            <text \n              class=\"user-nickname\" \n              :style=\"{ \n                fontSize: `${nicknameSize}rpx`, \n                marginLeft: `${nicknameMarginLeft}rpx` \n              }\"\n            >\n              {{ item.user?.nickname || '未知用户' }}\n            </text>\n          </view>\n        </view>\n      </view>\n    </view>\n\n    <!-- 其他列：正常瀑布流排版 -->\n    <view\n      class=\"waterfall-column\"\n      v-for=\"(column, index) in otherColumns\"\n      :key=\"index + 1\" \n      :style=\"{ width: columnWidth }\"\n    >\n      <view\n        class=\"waterfall-item\"\n        v-for=\"item in column\"\n        :key=\"item.id\"\n        :style=\"{ marginBottom: gap + 'rpx' }\"\n        @click=\"goToDetail(item.id, item.type)\"\n      >\n        <image\n          class=\"waterfall-img\"\n          :src=\"item.imgUrl\"\n          mode=\"widthFix\"\n          :alt=\"item.title\"\n          @load=\"handleImageLoad($event, item, index + 1)\"\n          @error=\"handleImageError(item)\"\n          :style=\"{ borderRadius: `${borderRadius}rpx ${borderRadius}rpx 0 0` }\"\n        />\n        \n        <view class=\"waterfall-content\" :style=\"{ padding: `${contentPadding}rpx` }\">\n          <!-- 标签区域 -->\n          <view class=\"tags\" v-if=\"item.tags && item.tags.length > 0\">\n            <view class=\"tag-view\" v-for=\"(tag, index) in item.tags\" :key=\"index\">\n              <uni-tag \n                size=\"mini\"\n                :text=\"tag\" \n                :type=\"getTagType(tag)\" \n              />\n            </view>\n          </view>\n          \n          <text \n            class=\"waterfall-title\" \n            :style=\"{ fontSize: `${titleSize}rpx`, marginTop: `${titleMarginTop}rpx` }\"\n          >\n            {{ item.title }}\n          </text>\n          \n          <!-- 价格信息 -->\n          <text \n            class=\"price-text\"\n            :style=\"{ \n              fontSize: `${priceSize}rpx`, \n              marginTop: `${priceMarginTop}rpx`,\n              color: priceColor\n            }\"\n          >\n            {{ item.type === '出物' ? '￥' : '￥' }}{{ item.price }}\n          </text>\n          \n          <!-- 用户信息区域 -->\n          <view class=\"user-info\" :style=\"{ marginTop: `${userInfoMarginTop}rpx` }\">\n            <image \n              class=\"user-avatar\" \n              :src=\"item.user?.avatar\" \n              :style=\"{ \n                width: `${avatarSize}rpx`, \n                height: `${avatarSize}rpx`, \n                borderRadius: `${avatarSize / 2}rpx` \n              }\"\n              mode=\"widthFix\"\n            />\n            <text \n              class=\"user-nickname\" \n              :style=\"{ \n                fontSize: `${nicknameSize}rpx`, \n                marginLeft: `${nicknameMarginLeft}rpx` \n              }\"\n            >\n              {{ item.user?.nickname || '未知用户' }}\n            </text>\n          </view>\n        </view>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, watch, onMounted, computed } from 'vue';\nimport UniTag from '@dcloudio/uni-ui/lib/uni-tag/uni-tag.vue'; // 显式引入uni-tag\n\n// 组件属性定义\nconst props = defineProps({\n  list: {\n    type: Array,\n    default: () => [],\n    required: true\n  },\n  columnCount: {\n    type: Number,\n    default: 2,\n    validator: (val) => val >= 1 && val <= 5\n  },\n  gap: {\n    type: Number,\n    default: 20\n  },\n  borderRadius: {\n    type: Number,\n    default: 10\n  },\n  contentPadding: {\n    type: Number,\n    default: 16\n  },\n  titleSize: {\n    type: Number,\n    default: 28\n  },\n  titleMarginTop: {\n    type: Number,\n    default: 8\n  },\n  // 价格相关属性\n  priceSize: {\n    type: Number,\n    default: 26\n  },\n  priceMarginTop: {\n    type: Number,\n    default: 8\n  },\n  priceColor: {\n    type: String,\n    default: '#ff4d4f'\n  },\n  // 用户信息相关属性\n  userInfoMarginTop: {\n    type: Number,\n    default: 12\n  },\n  avatarSize: {\n    type: Number,\n    default: 40\n  },\n  nicknameSize: {\n    type: Number,\n    default: 24\n  },\n  nicknameMarginLeft: {\n    type: Number,\n    default: 8\n  }\n});\n\n// 根据标签内容获取类型\nconst getTagType = (tagText) => {\n  if (tagText === '需求') {\n    return 'warning';\n  } else if (tagText === '可刀' || tagText === '不可刀') {\n    return 'error';\n  }\n  return 'primary';\n};\n\n// 状态管理\nconst firstColumnItems = ref([]);\nconst otherColumns = ref([]);\nconst columnHeights = ref([]);\nconst imageSizes = ref({});\n\n// 计算列宽度\nconst columnWidth = computed(() => {\n  return `calc( (100% - ${(props.columnCount - 1) * props.gap}rpx) / ${props.columnCount} )`;\n});\n\n// 初始化列\nconst initColumns = () => {\n  columnHeights.value = Array(props.columnCount).fill(0);\n  columnHeights.value[0] = 300; // 第一列固定图片初始高度\n  otherColumns.value = Array.from({ length: props.columnCount - 1 }, () => []);\n  firstColumnItems.value = [];\n  distributeItems();\n};\n\n// 分配数据到各列\nconst distributeItems = () => {\n  // 过滤掉无效数据\n  const validItems = props.list.filter(item => item && item.id);\n  \n  validItems.forEach(item => {\n    const minIndex = columnHeights.value.indexOf(Math.min(...columnHeights.value));\n    \n    if (minIndex === 0) {\n      firstColumnItems.value.push(item);\n    } else {\n      otherColumns.value[minIndex - 1].push(item);\n    }\n    \n    // 更精准的高度预估\n    const tagAdjustment = item.tags?.length > 1 ? (item.tags.length - 1) * 20 : 0;\n    const baseHeight = item.type === '出物' ? 320 : 300;\n    columnHeights.value[minIndex] += baseHeight + tagAdjustment;\n  });\n};\n\n// 处理图片加载\nconst handleImageLoad = (e, item, columnIndex) => {\n  const { width, height } = (e && e.detail) || {};\n  if (width && height) {\n    imageSizes.value[item.id] = { width, height };\n    const imageRatio = height / width;\n    const estimatedHeight = 300 * imageRatio; // 基于300rpx宽度计算\n    const tagHeightAdjustment = item.tags?.length > 1 ? 20 : 0;\n    const contentHeight = 120 + tagHeightAdjustment; // 内容区基础高度\n    const totalHeight = estimatedHeight + contentHeight;\n    columnHeights.value[columnIndex] = totalHeight;\n  } else {\n    // 无法获取尺寸时采用保守估计，不替换图片\n    const tagHeightAdjustment = item.tags?.length > 1 ? 20 : 0;\n    const contentHeight = 120 + tagHeightAdjustment;\n    columnHeights.value[columnIndex] = 300 + contentHeight;\n  }\n};\n\nconst handleImageError = (item) => {\n  // 加载失败时才使用默认图\n  item.imgUrl = 'https://api.shaolezhuan.cn/lzphoto/productDefault.jpg';\n};\n\n// 点击商品跳转到详情页\nconst goToDetail = (id, type) => {\n  const targetType = type || 'product';\n  uni.navigateTo({\n    url: `/pages/ProductDetail/ProductDetail?id=${id}&type=${targetType}`,\n  });\n};\n\n// 监听属性变化\nwatch(\n  () => [props.list, props.columnCount, props.gap],\n  () => initColumns(),\n  { deep: true, immediate: true }\n);\n\n// 组件挂载时初始化\nonMounted(() => {\n  initColumns();\n});\n</script>\n\n<style scoped>\n.waterfall-container {\n  display: flex;\n  justify-content: space-between;\n  box-sizing: border-box;\n  padding: 0 30rpx; /* 与父组件保持一致的左右边距 */\n}\n\n.waterfall-column {\n  display: flex;\n  flex-direction: column;\n}\n\n.waterfall-item {\n  background-color: #ffffff;\n  border-radius: 10rpx;\n  overflow: hidden;\n  box-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.05);\n  transition: transform 0.2s ease;\n}\n\n/* 固定的第一张图片样式 */\n.fixed-first-item {\n  background-color: transparent;\n  box-shadow: none;\n}\n\n.fixed-first-item:hover {\n  transform: none;\n}\n\n.waterfall-item:hover {\n  transform: translateY(-2rpx);\n}\n\n.waterfall-img {\n  width: 100%;\n  display: block;\n}\n\n.waterfall-content {\n  background-color: #ffffff;\n}\n\n/* 标签容器支持自动换行 */\n.tags {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 8rpx;\n  padding-bottom: 4rpx;\n}\n\n.tag-view {\n  margin: 0;\n}\n\n.waterfall-title {\n  display: -webkit-box;\n  -webkit-box-orient: vertical;\n  -webkit-line-clamp: 2;\n  overflow: hidden;\n  word-break: break-all;\n  color: #333333;\n  line-height: 1.4;\n}\n\n.price-text {\n  font-weight: 500;\n}\n\n.user-info {\n  display: flex;\n  align-items: center;\n}\n\n.user-avatar {\n  display: block;\n  object-fit: cover;\n  border: 1px solid #f0f0f0;\n}\n\n.user-nickname {\n  color: #666;\n  font-size: 22rpx;\n}\n</style>","import Component from 'C:/Users/86133/Desktop/demo/Lezhuan/components/Waterfall-one.vue'\nwx.createComponent(Component)"],"names":["ref","computed","uni","watch","onMounted"],"mappings":"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"}