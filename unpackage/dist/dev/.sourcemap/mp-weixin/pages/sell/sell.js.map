{"version":3,"file":"sell.js","sources":["pages/sell/sell.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvc2VsbC9zZWxsLnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"my-sold-page\">\n    <!-- 顶部导航栏 -->\n    <view class=\"navbar\">\n      <text class=\"nav-title\">我卖出的商品</text>\n    </view>\n    \n    <!-- 搜索和筛选区域 -->\n    <view class=\"filter-container\">\n      <view class=\"search-box\">\n        <uni-icons type=\"search\" size=\"24\" color=\"#999\" class=\"search-icon\"></uni-icons>\n        <input \n          type=\"text\" \n          placeholder=\"搜索卖出的商品...\" \n          v-model=\"searchKeyword\"\n          @input=\"handleSearch\"\n          class=\"search-input\"\n        />\n      </view>\n      \n      <view class=\"picker-container\">\n        <view class=\"picker-item\">\n          <text class=\"picker-label\">分类:</text>\n          <picker \n            mode=\"selector\"\n            :range=\"categoryRange\"\n            :value=\"categoryIndex\"\n            @change=\"handleCategoryChange\"\n            class=\"custom-picker\"\n          >\n            <view class=\"picker-display\">\n              {{ categoryRange[categoryIndex] }}\n              <uni-icons type=\"down\" size=\"18\" color=\"#999\" class=\"picker-icon\"></uni-icons>\n            </view>\n          </picker>\n        </view>\n        \n        <view class=\"picker-item\">\n          <text class=\"picker-label\">时间:</text>\n          <picker \n            mode=\"selector\"\n            :range=\"timeRange\"\n            :value=\"timeIndex\"\n            @change=\"handleTimeChange\"\n            class=\"custom-picker\"\n          >\n            <view class=\"picker-display\">\n              {{ timeRange[timeIndex] }}\n              <uni-icons type=\"down\" size=\"18\" color=\"#999\" class=\"picker-icon\"></uni-icons>\n            </view>\n          </picker>\n        </view>\n      </view>\n    </view>\n    \n    <!-- 商品列表组件 -->\n    <view v-if=\"isLoading\" class=\"loading-state\">\n      <uni-icons type=\"loading\" size=\"40\" color=\"#7c89ff\" spin></uni-icons>\n      <text class=\"loading-text\">加载中...</text>\n    </view>\n    \n    <CommonGoodsList \n      v-else-if=\"filteredSoldGoods.length > 0\"\n      :goodsList=\"filteredSoldGoods\" \n      :showPrice=\"true\"\n      :showStatus=\"true\"\n      :disableNavigation=\"true\"\n    />\n    \n    <view class=\"empty-state\" v-else>\n      <uni-icons type=\"empty\" size=\"60\" color=\"#ccc\"></uni-icons>\n      <text class=\"empty-text\">暂无卖出的商品</text>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, onMounted, computed, onUnmounted } from 'vue';\nimport CommonGoodsList from '@/components/CommonGoodsList.vue';\nimport uniIcons from '@dcloudio/uni-ui/lib/uni-icons/uni-icons.vue';\n// 导入接口封装\nimport productApi from '@/api/product.js';\nimport { sanitizeImageUrl, ensureLoggedIn } from '@/utils/uniHelper';\n\n// 基础状态\nconst searchKeyword = ref('');\nconst soldGoods = ref([]);\nconst isLoading = ref(false); // 加载状态\n\n// 筛选器配置\nconst categoryRange = ref(['全部分类']);\nconst timeRange = ref(['全部时间', '近一周', '近一个月', '近三个月', '更早']);\n\n// 筛选器选中索引\nconst categoryIndex = ref(0);\nconst timeIndex = ref(0);\n\n// 页面加载时获取数据\nonMounted(() => {\n  if (!ensureLoggedIn({ content: '登录后才能查看我卖出的商品', redirectTo: '/pages/mine/mine' })) return;\n  fetchSoldGoods();\n  // 监听页面显示事件，重新获取数据\n  uni.$on('pageShow', fetchSoldGoods);\n});\n\n// 获取已卖出商品列表（调用后端接口）\nconst fetchSoldGoods = async () => {\n  try {\n    isLoading.value = true;\n    // 构造筛选参数（根据后端接口要求调整）\n    const soldData = {\n      current: 1,\n      size: 1000,\n      status: 'sold', \n    };\n    \n    // 调用后端接口\n    const res = await productApi.getMyGoods(soldData);\n    const rawGoodsList = res.data.records || [];\n    \n    console.log('后端返回的已卖出商品数据:', rawGoodsList);\n    \n    // 数据映射：将后端返回格式转换为前端所需格式\n    soldGoods.value = rawGoodsList.map(raw => ({\n      id: raw.id, // 商品ID\n      title: raw.title || '未命名商品', // 商品标题\n      desc: raw.description || '', // 商品描述\n      imgUrl: sanitizeImageUrl(raw.mainImageUrl, 'product'), // 商品主图（加默认图）\n      price: raw.price || 0, // 交易价格\n      category: raw.categoryName || '其他', // 分类名称\n      attributes: raw.attributes ? JSON.parse(raw.attributes) : [], // 商品属性（若为JSON字符串需解析）\n      status: raw.status || '已完成', // 交易状态\n      transactionTime: raw.transactionTime || '', // 交易时间\n      publishTime: raw.createdAt ? new Date(raw.createdAt).getTime() : Date.now(), // 发布时间戳\n    }));\n    \n    // 动态生成种类筛选选项\n    const categories = [...new Set(soldGoods.value.map(item => item.category))];\n    categoryRange.value = ['全部分类', ...categories];\n    \n  } catch (error) {\n    console.error('获取已卖出商品列表失败:', error);\n    uni.showToast({\n      title: '加载失败，请稍后重试',\n      icon: 'none',\n      duration: 2000\n    });\n    soldGoods.value = []; // 异常时清空数据\n  } finally {\n    isLoading.value = false; // 无论成功失败都关闭加载\n  }\n};\n\n// 综合筛选逻辑\nconst filteredSoldGoods = computed(() => {\n  return soldGoods.value.filter(goods => {\n    // 搜索筛选（不区分大小写）\n    const matchesSearch = searchKeyword.value === '' \n      ? true \n      : goods.title.toLowerCase().includes(searchKeyword.value.toLowerCase()) \n        || goods.desc.toLowerCase().includes(searchKeyword.value.toLowerCase());\n    \n    // 种类筛选\n    const selectedCategory = categoryRange.value[categoryIndex.value];\n    const matchesCategory = selectedCategory === '全部分类' \n      ? true \n      : goods.category === selectedCategory;\n    \n    // 时间筛选\n    const matchesTime = filterByTime(goods.publishTime);\n    \n    return matchesSearch && matchesCategory && matchesTime;\n  });\n});\n\n// 按时间筛选逻辑\nconst filterByTime = (publishTime) => {\n  const now = Date.now();\n  const oneWeekAgo = now - 7 * 24 * 3600 * 1000;\n  const oneMonthAgo = now - 30 * 24 * 3600 * 1000;\n  const threeMonthsAgo = now - 90 * 24 * 3600 * 1000;\n  \n  switch (timeIndex.value) {\n    case 0: // 全部时间\n      return true;\n    case 1: // 近一周\n      return publishTime >= oneWeekAgo;\n    case 2: // 近一个月\n      return publishTime >= oneMonthAgo;\n    case 3: // 近三个月\n      return publishTime >= threeMonthsAgo;\n    case 4: // 更早\n      return publishTime < threeMonthsAgo;\n    default:\n      return true;\n  }\n};\n\n// 筛选器事件处理\nconst handleSearch = () => {\n  // 搜索由computed自动触发本地筛选\n};\n\nconst handleCategoryChange = (e) => {\n  categoryIndex.value = e.detail.value;\n  // 种类变化时重新请求接口（若需要服务端筛选）\n  fetchSoldGoods();\n};\n\nconst handleTimeChange = (e) => {\n  timeIndex.value = e.detail.value;\n  // 时间变化时仅本地筛选（也可根据需求改为重新请求接口）\n};\n\n// 页面卸载时移除监听\nonUnmounted(() => {\n  uni.$off('pageShow', fetchSoldGoods);\n});\n</script>\n\n<style scoped>\n.my-sold-page {\n  background-color: #f5f7fa;\n  min-height: 100vh;\n  padding-bottom: 40rpx;\n}\n\n/* 导航栏样式 */\n.navbar {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  height: 100rpx;\n  padding: 0 30rpx;\n  background-color: #fff;\n  box-shadow: 0 2rpx 10rpx rgba(0, 0, 0, 0.05);\n  position: sticky;\n  top: 0;\n  z-index: 999;\n}\n\n.nav-title {\n  font-size: 36rpx;\n  font-weight: 600;\n  color: #333;\n}\n\n/* 筛选区域样式 */\n.filter-container {\n  padding: 20rpx;\n  background-color: #fff;\n  margin-bottom: 20rpx;\n  box-shadow: 0 2rpx 5rpx rgba(0, 0, 0, 0.03);\n}\n\n.search-box {\n  display: flex;\n  align-items: center;\n  background-color: #f5f7fa;\n  border-radius: 60rpx;\n  padding: 0 20rpx;\n  height: 70rpx;\n  margin-bottom: 20rpx;\n}\n\n.search-icon {\n  margin-right: 10rpx;\n}\n\n.search-input {\n  flex: 1;\n  height: 100%;\n  font-size: 28rpx;\n  color: #333;\n  background: transparent;\n}\n\n.picker-container {\n  display: flex;\n  gap: 20rpx;\n  overflow-x: auto;\n  padding-bottom: 10rpx;\n}\n\n.picker-item {\n  display: flex;\n  align-items: center;\n  background-color: #f5f7fa;\n  border-radius: 40rpx;\n  padding: 0 20rpx;\n  height: 60rpx;\n  flex-shrink: 0;\n}\n\n.picker-label {\n  font-size: 28rpx;\n  color: #666;\n  margin-right: 10rpx;\n}\n\n.custom-picker {\n  width: auto;\n}\n\n.picker-display {\n  display: flex;\n  align-items: center;\n  font-size: 28rpx;\n  color: #333;\n  padding: 0 5rpx;\n}\n\n.picker-icon {\n  margin-left: 8rpx;\n}\n\n/* 加载状态样式 */\n.loading-state {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 100rpx 0;\n  color: #7c89ff;\n}\n\n.loading-text {\n  margin-top: 20rpx;\n  font-size: 28rpx;\n}\n\n/* 空状态样式 */\n.empty-state {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 100rpx 0;\n  color: #ccc;\n}\n\n.empty-text {\n  margin-top: 20rpx;\n  font-size: 28rpx;\n}\n</style>","import MiniProgramPage from 'C:/Users/86133/Desktop/demo/Lezhuan/pages/sell/sell.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","onMounted","ensureLoggedIn","uni","productApi","sanitizeImageUrl","computed","onUnmounted"],"mappings":"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"}