{"version":3,"file":"post.js","sources":["pages/post/post.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcG9zdC9wb3N0LnZ1ZQ"],"sourcesContent":["<template>\n<view class=\"post-page\">\n  <!-- 弹窗：优先显示，关闭后展示页面内容 -->\n    <view class=\"popup-overlay\" v-if=\"showPopup\">\n      <view class=\"popup-container\">\n        <view class=\"popup-content\">【发布提醒】单页限一件物品，勿多物品混发；遵守平台规则及相应法律法规，为保障交易安全和用户的使用体验，我们将对发布内容逐一审核，违规严惩至封号！</view>\n        <button \n          class=\"popup-close-btn\" \n          @click=\"showPopup = false\"\n          :disabled=\"countdown > 0\"\n        >\n          {{ countdown > 0 ? `请等待 ${countdown} 秒` : '我知道了' }}\n        </button>\n      </view>\n    </view> \n\t<view class=\"container\" v-if=\"!showPopup\">\n\t  <!-- 状态栏占位 -->\n\t  <view class=\"statusBar\" :style=\"{ height: statusBarHeight + 'px' }\"></view>\n\t  <!-- 自定义导航栏 -->\n\t  <view class=\"custom-nav\">\n\t    <view class=\"back-btn\" @click=\"handleBack\">\n\t      <uni-icons type=\"left\" size=\"24\"></uni-icons>\n\t    </view>\n\t    <view class=\"nav-title\">发宝贝</view>\n\t  </view>\n\t  <!-- 内容区域 -->\n\t  <view class=\"content\">\n\t    <!-- 图片上传区域 -->\n\t    <view class=\"upload-area\">\n\t      <view class=\"upload-title\">添加图片（最多9张）</view>\n\t      <view class=\"upload-grid\">\n\t        <!-- 上传按钮 -->\n\t        <view class=\"upload-item add-btn\" @click=\"chooseImage\">\n\t          <uni-icons type=\"plus\" size=\"30\" color=\"#999\"></uni-icons>\n\t        </view>\n\t        \n\t        <!-- 已上传图片 -->\n\t        <view class=\"upload-item image-item\" v-for=\"(img, index) in images\" :key=\"index\">\n\t          <image :src=\"img\" mode=\"aspectFill\" class=\"upload-img\"></image>\n\t          <view class=\"delete-btn\" @click.stop=\"deleteImage(index)\">\n\t            <uni-icons type=\"close\" size=\"18\" color=\"#fff\"></uni-icons>\n\t          </view>\n\t        </view>\n\t      </view>\n\t    </view>\n\t\t  <view class=\"input-area1\">\n\t\t\t<textarea \n\t\t\t\tplaceholder=\"填写商品名称\" \n\t\t\t\tv-model=\"title\"\n\t\t\t\tclass=\"desc-input1\"\n\t\t\t\tmaxlength=\"50\"\n\t\t\t\tauto-height\n\t\t\t></textarea>\n\t\t\t<view class=\"word-count\">{{ title.length }}/50</view>\n\t\t  </view>\n\t    <!-- 商品描述 -->\n\t    <view class=\"input-area\">\n\t      <textarea \n\t        placeholder=\"描述一下宝贝的品牌型号、成色、使用情况等信息以及您所在的宿舍区域能更好找到买家哦~\" \n\t        v-model=\"description\"\n\t        class=\"desc-input\"\n\t        maxlength=\"500\"\n\t        auto-height\n\t      ></textarea>\n\t      <view class=\"word-count\">{{ description.length }}/500</view>\n\t    </view>\n\t\t<view class=\"category-selectors\">\n\t\t  <!-- 选择器容器 - 一排显示三个 -->\n\t\t  <view class=\"select-row\">\n\t\t    <!-- 第一级：物品种类 -->\n\t\t    <view class=\"select-item\" @click=\"toggleSelector(1)\">\n\t\t      <view class=\"select-value\">{{ selectedCategory || '物品种类' }}</view>\n\t\t      <uni-icons \n\t\t        type=\"down\" \n\t\t        size=\"18\" \n\t\t        color=\"#999\"\n\t\t        :class=\"{ 'rotate-icon': activeSelector === 1 }\"\n\t\t      ></uni-icons>\n\t\t    </view>\n\t\t\n\t\t    <!-- 第二级：子分类 -->\n\t\t    <view class=\"select-item\" @click=\"toggleSelector(2)\" :class=\"{ 'disabled': !selectedCategory }\">\n\t\t      <view class=\"select-value\">{{ selectedSubcategory || '子分类' }}</view>\n\t\t      <uni-icons \n\t\t        type=\"down\" \n\t\t        size=\"18\" \n\t\t        color=\"#999\"\n\t\t        :class=\"{ 'rotate-icon': activeSelector === 2 }\"\n\t\t      ></uni-icons>\n\t\t    </view>\n\t\t\n\t\t    <!-- 第三级：成色 -->\n\t\t    <view class=\"select-item\" @click=\"toggleSelector(3)\">\n\t\t      <view class=\"select-value\">{{ selectedCondition || '成色' }}</view>\n\t\t      <uni-icons \n\t\t        type=\"down\" \n\t\t        size=\"18\" \n\t\t        color=\"#999\"\n\t\t        :class=\"{ 'rotate-icon': activeSelector === 3 }\"\n\t\t      ></uni-icons>\n\t\t    </view>\n\t\t  </view>\n\t\t\n\t\t  <!-- 下拉面板 -->\n\t\t  <view class=\"select-panel\" v-if=\"activeSelector\">\n\t\t    <view class=\"panel-content\">\n\t\t      <!-- 物品种类列表 -->\n\t\t      <view v-if=\"activeSelector === 1\" class=\"option-list\">\n\t\t        <view \n\t\t          class=\"option-item\" \n\t\t          v-for=\"category in Object.keys(categoryMap)\" \n\t\t          :key=\"category\"\n\t\t          @click=\"selectCategory(category)\"\n\t\t        >\n\t\t          {{ category }}\n\t\t        </view>\n\t\t      </view>\n\t\t\n\t\t      <!-- 子分类列表 -->\n\t\t      <view v-if=\"activeSelector === 2\" class=\"option-list\">\n\t\t        <view \n\t\t          class=\"option-item\" \n\t\t          v-for=\"subcategory in categoryMap[selectedCategory]\" \n\t\t          :key=\"subcategory\"\n\t\t          @click=\"selectSubcategory(subcategory)\"\n\t\t        >\n\t\t          {{ subcategory }}\n\t\t        </view>\n\t\t      </view>\n\t\t\n\t\t      <!-- 成色列表 -->\n\t\t      <view v-if=\"activeSelector === 3\" class=\"option-list\">\n\t\t        <view \n\t\t          class=\"option-item2\" \n\t\t          v-for=\"condition in conditions\" \n\t\t          :key=\"condition\"\n\t\t          @click=\"selectCondition(condition)\"\n\t\t        >\n\t\t          {{ condition }}\n\t\t        </view>\n\t\t      </view>\n\t\t    </view>\n\t\t  </view>\n\t\t\n\t\t  <!-- 遮罩层 -->\n\t\t <!-- <view \n\t\t    class=\"mask\" \n\t\t    v-if=\"activeSelector\"\n\t\t    @click=\"closeAllSelectors\"\n\t\t  ></view> -->\n\t\t</view>\n\t    <!-- 选项区域 -->\n\t    <view class=\"options-list\">\n\t      <!-- 价格 -->\n\t      <view class=\"option-item\" @click=\"handleOpenPricePopup\">\n\t        <view class=\"option-label\">价格</view>\n\t        <view class=\"option-value\">{{ price ? '¥' + price : '请填写' }}</view>\n\t        <uni-icons type=\"right\" size=\"18\" color=\"#999\"></uni-icons>\n\t      </view>\n\t      \n\t      <!-- 交易方式 -->\n\t      <view class=\"option-item\" @click=\"handleOpenTradePopup\">\n\t        <view class=\"option-label\">交易方式</view>\n\t        <view class=\"option-value\">{{ tradeMethod || '请选择' }}</view>\n\t        <uni-icons type=\"right\" size=\"18\" color=\"#999\"></uni-icons>\n\t      </view>\n\t      \n\t      <!-- 是否可砍价 -->\n\t      <view class=\"option-item\" @click=\"handleOpenNegotiable\">\n\t        <view class=\"option-label\">是否可小刀</view>\n\t        <view class=\"option-value\">{{ negotiable || '请选择' }}</view>\n\t\t\t  <uni-icons type=\"right\" size=\"18\" color=\"#999\"></uni-icons>\n\t      </view>\n\t    </view>\n\t\t  <view @click=\"onPublish\">\n\t\t    <button class=\"publish-btn\">发布</button>\n\t\t  </view>\n\t  </view>\n\t\n\t  <!-- 价格输入弹窗 -->\n\t  <uni-popup \n\t    ref=\"pricePopup\"\n\t    type=\"bottom\"\n\t    background-color=\"#fff\"\n\t    :mask=\"true\"\n\t    :mask-click=\"true\"\n\t    class=\"custom-popup\"\n\t  >\n\t   <view class=\"popup-content\">\n\t      <view class=\"popup-title\">设置价格</view>\n\t\t\t<!-- 服务费说明 -->\n\t\t\t<view class=\"service-fee-desc\">\n\t\t\t  <text class=\"fee-text\">基础软件服务费</text>\n\t\t\t  <text class=\"fee-rate\">免费</text>\n\t\t\t</view>\n\t      <view class=\"price-input-container\">\n\t        <text class=\"rmb-sign\">¥</text>\n\t        <input \n\t          type=\"number\" \n\t          v-model=\"price\" \n\t          placeholder=\"请输入价格\"\n\t          class=\"price-input\"\n\t          keyboard-type=\"number-pad\"\n\t        >\n\t        </input>\n\t      </view>\n\t\t    <!-- 原价输入区域 -->\n\t\t\t<view class=\"price-item\">\n\t\t\t  <text class=\"price-label\">原价</text>\n\t\t\t  <view class=\"price-input-wrapper\">\n\t\t\t\t<text class=\"rmb-sign\">¥</text>\n\t\t\t\t<input \n\t\t\t\t  type=\"number\" \n\t\t\t\t  v-model=\"originalPrice\" \n\t\t\t\t  placeholder=\"0.00\"\n\t\t\t\t  class=\"price-input\"\n\t\t\t\t  keyboard-type=\"number-pad\"\n\t\t\t\t  maxlength=\"8\"\n\t\t\t\t>\n\t\t\t\t</input>\n\t\t\t  </view>\n\t\t\t</view>\n\t      <view class=\"popup-buttons\">\n\t        <button class=\"cancel-btn\" @click=\"PriceModalCancel\">取消</button>\n\t        <button class=\"confirm-btn\" @click=\"PriceModalConfirm\">确定</button>\n\t      </view>\n\t    </view>\n\t  </uni-popup>\n\t\n\t  <!-- 交易方式弹窗 -->\n\t  <uni-popup \n\t    ref=\"tradePopup\"\n\t    type=\"bottom\"\n\t    background-color=\"#fff\"\n\t    class=\"custom-popup\"\n\t  >\n\t    <view class=\"popup-content\">\n\t      <view class=\"popup-title\">选择交易方式</view>\n\t      <view class=\"trade-methods\">\n\t        <view \n\t          class=\"trade-method\"\n\t          v-for=\"method in tradeMethods\" \n\t          :key=\"method.value\"\n\t          @click=\"selectTradeMethod(method.value)\"\n\t        >\n\t          {{ method.label }}\n\t          <uni-icons \n\t            type=\"checkmark\" \n\t            size=\"20\" \n\t            color=\"#FFCC00\"\n\t            v-if=\"tradeMethod === method.value\"\n\t          ></uni-icons>\n\t        </view>\n\t      </view>\n\t    </view>\n\t  </uni-popup>\n\t\t\n\t\t<!-- 是否可刀弹窗 -->\n\t\t<uni-popup\n\t\t  ref=\"negotiablePopup\"\n\t\t  type=\"bottom\"\n\t\t  background-color=\"#fff\"\n\t\t  :mask=\"true\"\n\t\t  :mask-click=\"true\"\n\t\t  class=\"custom-popup\"\n\t\t>\n\t\t  <view class=\"popup-content\">\n\t\t\t<view class=\"popup-title\">是否开启可刀？</view>\n\t\t\t<view class=\"options\">\n\t\t\t  <button class=\"option-btn\" @click=\"handleOptionSelect(true)\">是</button>\n\t\t\t  <button class=\"option-btn\" @click=\"handleOptionSelect(false)\">否</button>\n\t\t\t</view>\n\t\n\t\t\t<!-- 可刀价格输入区域（默认隐藏，选择“是”后显示） -->\n\t\t\t<view class=\"price-input-area\" v-if=\"showPriceInput\">\n\t\t\t  <text>最多可刀价格：</text>\n\t\t\t  <input \n\t\t\t\ttype=\"number\" \n\t\t\t\tv-model=\"negotiablePrice\" \n\t\t\t\tplaceholder=\"请输入可刀价格\"\n\t\t\t\tclass=\"price-input\"\n\t\t\t  >\n\t\t\t  <button class=\"confirm-price-btn\" @click=\"confirmNegotiablePrice\">确认</button>\n\t\t\t</view>\n\t\t  </view>\n\t\t</uni-popup>\n\t\t<!-- 草稿确认弹窗 -->\n\t\t<uni-popup \n\t\t  ref=\"draftPopup\"\n\t\t  type=\"center\"\n\t\t  background-color=\"#fff\"\n\t\t  :mask=\"true\"\n\t\t  :mask-click=\"false\"\n\t\t  class=\"custom-popup\"\n\t\t>\n\t\t  <view class=\"popup-content\">\n\t\t    <view class=\"popup-title\">确认退出吗？</view>\n\t\t    <view class=\"popup-desc\" style=\"text-align:center; font-size:28rpx; color:#666; margin:32rpx 0;\">\n\t\t      已输入的内容可保存为草稿，下次继续编辑\n\t\t    </view>\n\t\t    <view class=\"popup-buttons\" style=\"gap:24rpx;\">\n\t\t      <button class=\"cancel-btn\" @click=\"handleDraftCancel\">确认退出</button>\n\t\t      <button class=\"confirm-btn\" @click=\"handleSaveDraft\">保存草稿</button>\n\t\t    </view>\n\t\t  </view>\n\t\t</uni-popup>\n\t</view>\n</view>\t\n</template>\n\n<script setup>\nimport { ref, nextTick, computed, onMounted, onUnmounted } from 'vue';\nimport { onBackPress } from '@dcloudio/uni-app';\nimport productApi from '@/api/product.js';\nimport { useStorage } from '@/hooks/useStorage'\nimport { \n  getStatusBarHeight, \n  getTitleBarHeight,\n  getNavBarHeight,\n} from '@/utils/system.js';\nimport { ensureLoggedIn, ensureStudentCertified, ensureMembership } from '@/utils/uniHelper';\n\nconst { getStorage, setStorage } = useStorage();\n// 导航相关高度数据\nconst statusBarHeight = ref(0);\n\n// 启动倒计时函数\nconst startCountdown = () => {\n  timer = setInterval(() => {\n    if (countdown.value > 0) {\n      countdown.value--;\n    } else {\n      clearInterval(timer);\n    }\n  }, 1000);\n};\n\n// 图片相关\nconst images = ref([]);\n\n// 解析并归一化后端返回的图片URL（支持多种键名与相对路径）\nconst normalizeImageUrl = (rawUrl) => {\n  if (!rawUrl) return '';\n  // 若是数组里取第一个有值的url\n  if (Array.isArray(rawUrl)) {\n    const found = rawUrl.find(u => !!u);\n    return normalizeImageUrl(found);\n  }\n  // 对象场景：常见键名兼容\n  if (typeof rawUrl === 'object') {\n    const candidate = rawUrl.url || rawUrl.fileUrl || rawUrl.path || rawUrl.src || rawUrl.link || rawUrl[0];\n    return normalizeImageUrl(candidate);\n  }\n  // 字符串场景：绝对/相对路径处理\n  if (typeof rawUrl === 'string') {\n    // 直接是完整URL\n    if (/^https?:\\/\\//i.test(rawUrl)) return rawUrl;\n    // 去除可能的包裹引号\n    const trimmed = rawUrl.trim().replace(/^\"|\"$/g, '').replace(/^'|'$/g, '');\n    if (/^https?:\\/\\//i.test(trimmed)) return trimmed;\n    // 可能是JSON字符串中抽出的相对地址，如 \"/upload/xxx.jpg\" 或 \"upload/xxx.jpg\"\n    if (trimmed.startsWith('/')) return `https://api.shaolezhuan.cn${trimmed}`;\n    return `https://api.shaolezhuan.cn/${trimmed}`;\n  }\n  return '';\n};\n\n// 从本地缓存加载草稿\nconst loadDraftFromStorage = () => {\n  try {\n    const draft = getStorage('productDraft');\n\tconsole.log('草稿内容为:',draft)\n    if (draft && typeof draft === 'object') {\n      // 回显表单数据\n      title.value = draft.title || '';\n      description.value = draft.description || '';\n      images.value = draft.images && Array.isArray(draft.images) ? draft.images : [];\n      price.value = draft.price || '';\n      originalPrice.value = draft.originalPrice || '';\n      tradeMethod.value = draft.tradeMethod || '';\n      selectedCategory.value = draft.category || '';\n      selectedSubcategory.value = draft.subcategory || '';\n      selectedCondition.value = draft.condition || '';\n      negotiable.value = draft.negotiable || '不小刀';\n      negotiablePrice.value = draft.negotiablePrice || '';\n      showPriceInput.value = draft.negotiable && draft.negotiable.includes('可小刀') ? true : false;\n    }\n  } catch (error) {\n    console.error('加载草稿失败:', error);\n  }\n};\n\n// 选择图片并上传\nconst chooseImage = async () => {\n  if (images.value.length >= 9) {\n    uni.showToast({\n      title: '最多只能上传9张图片',\n      icon: 'none'\n    });\n    return;\n  }\n  \n  // 1. 选择图片，获取临时路径数组\n  const chooseRes = await uni.chooseImage({\n    count: 9 - images.value.length, // 最多选择剩余可上传数量\n    sizeType: ['original', 'compressed'],\n    sourceType: ['album', 'camera']\n  });\n  \n  // 2. 显示全局加载中（避免多次弹窗）\n  uni.showLoading({ title: '上传中...', mask: true });\n  \n  try {\n    // 3. 循环上传图片（并行上传优化）\n    const uploadPromises = chooseRes.tempFilePaths.map(async (tempPath) => {\n      // 调用上传接口\n      const uploadRes = await uni.uploadFile({\n        url: 'https://api.shaolezhuan.cn/api/upload/image',\n        filePath: tempPath, // 临时路径作为上传源\n        name: 'file', // 后端接收文件的参数名（需与后端一致）\n        header: {\n          // 兼容后端两种写法：部分接口要求 Bearer，部分接口直接传 token\n          'Authorization': uni.getStorageSync('token')?.startsWith('Bearer')\n            ? uni.getStorageSync('token')\n            : `Bearer ${uni.getStorageSync('token')}`\n        },\n        formData: { \n          userId: uni.getStorageSync('userId'), // 注意：formData需要是对象格式\n          token: uni.getStorageSync('token')\n        }\n      });\n      \n      // 解析上传结果（兼容字符串/多种结构）\n      let parsed = null;\n      let urlCandidate = null;\n\n      // 1) 尝试当作JSON解析\n      if (typeof uploadRes.data === 'string') {\n        try {\n          parsed = JSON.parse(uploadRes.data);\n        } catch (e) {\n          // 非JSON字符串，可能就是URL\n          urlCandidate = uploadRes.data;\n        }\n      } else {\n        parsed = uploadRes.data;\n      }\n\n      // 2) 从常见结构提取URL（全面兼容后端返回）\n      if (!urlCandidate && parsed) {\n        // 普通对象或 data 包裹对象\n        const d = parsed.data ?? parsed;\n        // 数组场景（data是数组）\n        if (Array.isArray(d)) {\n          const first = d[0] ?? {};\n          urlCandidate = first.url || first.fileUrl || first.path || null;\n        } else {\n          urlCandidate = d.url || d.fileUrl || d.path || d.src || d.link || null;\n        }\n      }\n\n      // 3) 归一化为绝对URL\n      const finalUrl = normalizeImageUrl(urlCandidate);\n      console.log('上传结果原始：', uploadRes.data, '解析：', parsed, '归一化URL：', finalUrl);\n\n      // 4) 校验返回码 + URL\n      const ok = uploadRes.statusCode === 200 || parsed?.code === 200 || parsed?.status === 200;\n      if (!ok) {\n        throw new Error(`图片上传失败: ${(parsed && (parsed.msg || parsed.message)) || uploadRes.errMsg || '未知错误'}`);\n      }\n      if (!finalUrl) {\n        throw new Error('图片上传失败: 返回数据缺少URL');\n      }\n      return finalUrl;\n    });\n    \n    // 4. 等待所有图片上传完成，获取所有URL\n    const newUrls = await Promise.all(uploadPromises);\n    \n    // 5. 将新上传的URL添加到数组中\n    images.value = [...images.value, ...newUrls];\n    console.log('所有图片上传完成，永久URL列表:', images.value);\n    \n    uni.showToast({\n      title: `成功上传${newUrls.length}张图片`,\n      icon: 'success'\n    });\n    \n  } catch (error) {\n    console.error('上传失败:', error);\n    uni.showToast({\n      title: error.message || '图片上传失败',\n      icon: 'none'\n    });\n  } finally {\n    // 无论成功失败，都关闭加载\n    uni.hideLoading();\n  }\n};\n\n// 删除商品图片（前端删除+后端同步删除）\nconst deleteImage = async (index) => {\n  // 1. 获取要删除的图片永久URL\n  const deleteUrl = images.value[index];\n  console.log('要删除的文件路径:', deleteUrl);\n  if (!deleteUrl) return;\n\n  // 2. 弹出确认弹窗\n  uni.showModal({\n    title: '确认删除',\n    content: '确定要删除这张图片吗？删除后不可恢复',\n    cancelText: '取消',\n    confirmText: '删除',\n    async success(res) {\n      if (res.confirm) { \n        uni.showLoading({ title: '删除中...', mask: true });\n\n        try {\n          // 3. 调用后端删除接口（DELETE 请求，fileUrl 通过 Query 传参）\n          const token = uni.getStorageSync('token');\n          const auth = token?.startsWith('Bearer') ? token : `Bearer ${token}`;\n          const url = `https://api.shaolezhuan.cn/api/upload/file?fileUrl=${encodeURIComponent(deleteUrl)}`;\n          const deleteRes = await uni.request({\n            url,\n            method: 'DELETE',\n            header: {\n              'Authorization': auth,\n              'Content-Type': 'application/x-www-form-urlencoded'\n            }\n          });\n\n          // 4. 解析响应\n          const deleteData = deleteRes.data;\n          if (deleteData.code === 200 || deleteRes.statusCode === 200 || deleteRes.statusCode === 204) {\n            // 5. 前端数组同步删除\n            images.value.splice(index, 1);\n            uni.showToast({ title: '删除成功', icon: 'success' });\n          } else {\n            // 后端删除失败仍前端删除（可选逻辑）\n            images.value.splice(index, 1);\n            uni.showToast({ \n              title: '图片已从列表移除，服务器删除失败', \n              icon: 'none' \n            });\n            console.warn('后端删除失败:', deleteData.msg);\n          }\n        } catch (error) {\n          // 网络异常等情况处理\n          images.value.splice(index, 1);\n          uni.showToast({ \n            title: '网络异常，图片已从本地移除', \n            icon: 'none' \n          });\n          console.error('删除异常:', error);\n        } finally {\n          uni.hideLoading();\n        }\n      }\n    }\n  });\n};\n\n// 分类数据\nconst categoryMap = {\n  '电子数码': ['电脑外设', '耳机音响', '手机平板', '智能设备', '其他'],\n  '自行车': ['普通自行车', '山地车', '公路自行车', '电动自行车', '其他'],\n  '电器': ['吹风机', '干衣袋', '电灯风扇', '小厨具', '其他'],\n  '体育用品': [ '各种球类', '各种球拍', '健身器材', '运动装备', '其他'],\n  '二手书': [ '大一教材', '大二教材', '大三教材', '小说漫画', '其他'],\n  '生活用品': ['美容/护肤品', '服饰服装', '衣架/收纳', '椅子抱枕', '其他'],\n  '虚拟物品': ['游戏账号', '陪玩代打', '数字会员', '线上课程', '其他'],\n  '其他': ['学习用品', '手工制品', '宠物用品', '办公用品', '其他']\n};\n\n// 成色选项\nconst conditions = ['99新', '95新', '9成新', '8成新', '7成新', '6成新及以下'];\n\n// 选中的值\nconst selectedCategory = ref('');\nconst selectedSubcategory = ref('');\nconst selectedCondition = ref('');\n\n// 下拉面板控制\nconst activeSelector = ref(0); // 0: 关闭, 1: 物品种类, 2: 子分类, 3: 成色\n\n// 1. 弹窗状态\n// 弹窗控制\nconst showPopup = ref(true);\n// 倒计时秒数\nconst countdown = ref(3);\n// 定时器标识\nlet timer = null;\n\n// 切换下拉面板\nconst toggleSelector = (type) => {\n  // 如果点击的是已激活的面板，则关闭\n  if (activeSelector.value === type) {\n    activeSelector.value = 0;\n  } else {\n    // 子分类需要先选择主分类\n    if (type === 2 && !selectedCategory.value) return;\n    activeSelector.value = type;\n  }\n};\n\n// 关闭所有下拉面板\nconst closeAllSelectors = () => {\n  activeSelector.value = 0;\n};\n\n// 选择物品种类\nconst selectCategory = (category) => {\n  selectedCategory.value = category;\n  // 重置子分类\n  selectedSubcategory.value = '';\n  activeSelector.value = 0;\n};\n\n// 选择子分类\nconst selectSubcategory = (subcategory) => {\n  selectedSubcategory.value = subcategory;\n  activeSelector.value = 0;\n};\n\n// 选择成色\nconst selectCondition = (condition) => {\n  selectedCondition.value = condition;\n  activeSelector.value = 0;\n};\n\n// 商品描述\nconst description = ref('');\nconst title = ref('');\n\n// 价格相关\nconst price = ref('');\n// 原价\nconst originalPrice = ref(''); \nconst showPriceModal = ref(false);\n\n// 交易方式相关\nconst tradeMethods = [\n  { label: '线下自行交易', value: '线下自行交易' },\n];\nconst tradeMethod = ref('');\nconst showTradeModal = ref(false);\n\n// 选择交易方式\nconst selectTradeMethod = (value) => {\n  tradeMethod.value = value;\n  tradePopup.value.close();\n};\n\nconst pricePopup= ref(null);\n// 打开价格弹窗\nconst handleOpenPricePopup = async () => {\n  try {\n    await nextTick();\n\tpricePopup.value?.open('bottom'); \n  } catch (error) {\n    console.error('打开价格弹窗失败:', error);\n    uni.showToast({ title: '打开价格弹窗失败', icon: 'none' });\n  }\n};\n\n//取消\nconst PriceModalCancel=()=>{\n\tpricePopup.value?.close();\n\tprice.value=''\n}\n//确认\nconst PriceModalConfirm = () => {\n  // 验证售价\n  if (!price.value) {\n    uni.showToast({ title: '请输入售价', icon: 'none' });\n    return;\n  }\n  // 验证原价\n  if (originalPrice.value) {\n    if (Number(originalPrice.value) <= 0) {\n      uni.showToast({ title: '原价必须大于0', icon: 'none' });\n      return;\n    }\n    if (Number(originalPrice.value) < Number(price.value)) {\n      uni.showToast({ title: '原价不能低于售价', icon: 'none' });\n      return;\n    }\n  }\n  console.log(originalPrice.value)\n  pricePopup.value?.close();\n};\n\nconst tradePopup= ref(null);\n// 打开交易方式弹窗\nconst handleOpenTradePopup = async () => {\n  try {\n    await nextTick();\n\ttradePopup.value?.open('bottom');\n  } catch (error) {\n    console.error('打开交易方式弹窗失败:', error);\n    uni.showToast({ title: '打开交易方式弹窗失败', icon: 'none' });\n  }\n};\n\n// 控制是否显示可刀价格输入区域\nconst showPriceInput = ref(false);\nconst negotiable =ref();\n// 可刀价格\nconst negotiablePrice = ref('');\nconst negotiablePopup = ref(null);\n// 打开小刀弹窗\nconst handleOpenNegotiable = async () => {\n  try {\n    await nextTick();\n\tnegotiablePopup.value?.open('bottom'); \n\t// console.log(negotiable.value)\n  } catch (error) {\n    console.error('打开小刀弹窗失败:', error);\n    uni.showToast({ title: '打开小刀弹窗失败', icon: 'none' });\n  }\n};\n// 处理“是/否”选择\nconst handleOptionSelect = (isNegotiable) => {\n  if (isNegotiable) {\n    // 选择“是”，显示可刀价格输入区域\n    showPriceInput.value = true;\n  } else {\n    // 选择“否”，关闭弹窗\n\tnegotiable.value = '不小刀'\n    negotiablePopup.value?.close()\n  }\n};\n\nconst negotiablemoney = ref()\n// 确认可刀价格\nconst confirmNegotiablePrice = () => {\n  if (negotiablePrice.value) {\n\tnegotiable.value = '可小刀'+ negotiablePrice.value + '元'\n\tnegotiablePopup.value?.close()\n  } else {\n    uni.showToast({\n      title: '请输入可刀价格',\n      icon: 'none'\n    });\n  }\n};\n\n// 取消发布\nconst onCancel = () => {\n  uni.navigateBack();\n};\n\n// 发布商品\nconst onPublish = async () => {\n  // 发布前拦截：登录 → 学生认证 → 会员等级\n  if (!ensureLoggedIn({ content: '登录后才能发布商品', redirectTo: '/pages/mine/mine' })) return;\n  if (!ensureStudentCertified({ content: '发布商品需先完成学生认证' })) return;\n  if (!ensureMembership('normal', { content: '发布商品需普通会员或以上' })) return;\n  // 会员数量限制：交由后端统一校验并返回提示文案\n  // 仅在前端读取会员类型，用于后续弹框按钮文案（去升级/我已知晓）\n  // 为兼容后端返回中文/数字等格式，对 membershipType 进行归一化\n  const rawMembershipType = uni.getStorageSync('membershipType');\n  const membershipType = (() => {\n    const val = String(rawMembershipType ?? '').trim();\n    const lower = val.toLowerCase();\n    if (!val) return 'none';\n    if (/白金/.test(val) || lower.includes('platinum') || val === '2' || lower.includes('vip_platinum') || lower.includes('platinum_member')) return 'platinum';\n    if (/普通/.test(val) || lower === 'normal' || val === '1' || lower.includes('vip') || lower.includes('member')) return 'normal';\n    return lower === 'platinum' || lower === 'normal' ? lower : 'none';\n  })();\n  // 简单验证\n  if (images.value.length === 0) {\n    uni.showToast({\n      title: '请至少上传一张图片',\n      icon: 'none'\n    });\n    return;\n  }\n  \n  if (!description.value.trim()) {\n    uni.showToast({\n      title: '请填写商品描述',\n      icon: 'none'\n    });\n    return;\n  }\n  \n  if (!title.value.trim()) {\n    uni.showToast({\n      title: '请填写商品标题',\n      icon: 'none'\n    });\n    return;\n  }\n  \n  if (!price.value) {\n    uni.showToast({\n      title: '请填写价格',\n      icon: 'none'\n    });\n    handleOpenPricePopup();\n    return;\n  }\n  \n  if (!tradeMethod.value) {\n    uni.showToast({\n      title: '请选择交易方式',\n      icon: 'none'\n    });\n    handleOpenTradePopup();\n    return;\n  }\n  \n  if (!selectedCategory.value) {\n    uni.showToast({ title: '请选择物品种类', icon: 'none' });\n    return;\n  }\n  if (!selectedCondition.value) {\n    uni.showToast({ title: '请选择商品成色', icon: 'none' });\n    return;\n  }\n  \n  // 获取分类ID\n  const getCategoryId = () => {\n    // 定义分类与ID的映射关系\n    const categoryIdMap = {\n      '电子数码': 1,\n      '其他': 2,\n      '生活用品': 3,\n      '虚拟物品': 4,\n      '自行车': 5,\n      '体育用品': 6,\n      '电器': 7,\n      '二手书': 8\n    };\n    \n    // 根据选中的分类名返回对应的ID，默认返回0表示未找到\n    return categoryIdMap[selectedCategory.value] || 0;\n  };\n  //获取对应的商品ID（对象）\n  const categoryId = getCategoryId();\n  \n  // 将属性对象转换为JSON字符串\n   const attributesObj = {\n      category: selectedCategory.value,\n      subcategory: selectedSubcategory.value,\n      condition: selectedCondition.value\n   };\n  \n  const getSubmitData = () => {\n    return {\n\t  title: title.value,\n\t  description: description.value.trim(),\n\t  price: Number(price.value),\n\t  originalPrice: originalPrice.value,\n\t  categoryId: categoryId,//分类ID\n\t  attributes: JSON.stringify(attributesObj),//对象属性\n\t  isNegotiable: !(negotiable.value === undefined || negotiable.value === '不小刀'),\n\t  maxNegotiableAmount: negotiablePrice.value, //砍价金额\n\t  tradingMethod: tradeMethod.value,//交易方式\n\t  mainImageUrl: images.value[0],//商品主图链接\n\t  // 详情图提交为逗号分隔字符串（排除主图），以匹配后端 JSON 反序列化期望的 String 类型\n\t  detailImages: images.value.slice(1).join(','),\n    };\n  };\n  \n  // 构建表单数据\n  const productData = getSubmitData() \n  console.log('前端打包的发布商品数据:', productData);\n  \n   try {\n      // 提交发布商品\n      const createProductRes = await productApi.postProduct(productData);\n      console.log('后端订单返回的结果为：', createProductRes)\n      \n      // 发布成功后跳转（兼容201 Created）\n      if (createProductRes.code === 200 || createProductRes.code === 201) {\n        uni.showToast({\n          title: '发布成功',\n          icon: 'success'\n        });\n        \n        // 先重置表单再跳转\n        resetForm();\n        uni.removeStorageSync('productDraft');\n\t\t\n        setTimeout(() => {\n          uni.navigateTo({\n            url: '/pages/wait/wait' \n          });\n        }, 500)\n      } else if (createProductRes.code === 403) {\n        // 后端返回限制（比如达到发布次数/数量上限），弹窗提示用户\n        const msg = createProductRes.msg || createProductRes.message || '发布受限，请稍后再试';\n        uni.showModal({\n          title: '发布提醒',\n          content: msg,\n          cancelText: '去管理',\n          confirmText: membershipType === 'platinum' ? '我已知晓' : '去升级',\n          success: (res) => {\n            if (res.confirm) {\n              if (membershipType === 'platinum') {\n                // 白金会员：只关闭弹窗\n              } else {\n                uni.navigateTo({ url: '/pages/membership/membership' });\n              }\n            } else {\n              uni.navigateTo({ url: '/pages/publish/publish' });\n            }\n          }\n        });\n      } else {\n        // 其他业务失败：同样使用微信原生弹框样式，并沿用后端 msg\n        const msg = createProductRes.msg || createProductRes.message || '发布失败，请稍后再试';\n        uni.showModal({\n          title: '发布提醒',\n          content: msg,\n          cancelText: '去管理',\n          confirmText: membershipType === 'platinum' ? '我已知晓' : '去升级',\n          success: (res) => {\n            if (res.confirm) {\n              if (membershipType === 'platinum') {\n                // 白金会员：仅关闭弹框\n              } else {\n                uni.navigateTo({ url: '/pages/membership/membership' });\n              }\n            } else {\n              uni.navigateTo({ url: '/pages/publish/publish' });\n            }\n          }\n        });\n      }\n    } catch (error) {\n      // 请求失败（如网络错误、服务器异常等）\n      console.error('发布商品请求失败:', error);\n      uni.showToast({\n        title: '发布商品请求失败，请检查网络或稍后再试',\n        icon: 'none'\n      });\n    }\n};\n\n// 草稿弹窗引用\nconst draftPopup = ref(null);\n\nconst draftData = ref({});\n\n// 取消草稿：直接退出页面\nconst handleDraftCancel = () => {\n  draftPopup.value?.close();\n  setTimeout(() => {\n    // 返回上一页\n    uni.navigateBack({ delta: 1 });  \n    }, 300);\n};\n\n// 保存草稿并退出\nconst handleSaveDraft = () => {\n  // 构建完整的草稿数据（与回显字段对应）\n  draftData.value = {\n    title: title.value,\n    description: description.value.trim(),\n    images: [...images.value], // 深拷贝图片数组，避免引用问题\n    price: price.value,\n    originalPrice: originalPrice.value,\n    tradeMethod: tradeMethod.value,\n    category: selectedCategory.value,\n    subcategory: selectedSubcategory.value,\n    condition: selectedCondition.value,\n    negotiable: negotiable.value || '不小刀',\n    negotiablePrice: negotiablePrice.value,\n    saveTime: new Date().getTime() // 记录保存时间，便于后续管理\n  };\n\n  // 存入本地缓存（使用自定义的setStorage或原生API均可）\n  setStorage('productDraft', draftData.value);\n  // 若自定义setStorage有问题，可替换为原生API：\n  // uni.setStorageSync('productDraft', draft);\n\n  uni.showToast({ title: '草稿保存成功', icon: 'success' });\n  console.log('保存的草稿内容:', draftData.value);\n  \n  draftPopup.value?.close();\n  // 延迟退出，确保提示可见\n  setTimeout(() => {\n    uni.navigateBack({ delta: 1 });\n  }, 1500);\n};\n\nconst handleBack = () => {\n  // 检查是否有表单内容\n  if (description.value.trim() || images.value.length || price.value || tradeMethod.value) {\n    // 显示草稿保存弹窗\n    if (draftPopup.value) {\n      draftPopup.value.open('center');\n    }\n    return true; // 拦截返回\n  } else {\n    // 无内容时直接返回\n    uni.navigateBack({ delta: 1 });\n    return false;\n  }\n};\n// 监听页面返回，使用onBackPress生命周期钩子\nonBackPress((options) => {\n  if (options.from === 'backbutton') {\n    return handleBack(); // 调用统一处理函数\n  }\n  return false;\n});\n\n// 新增表单重置函数\nconst resetForm = () => {\n  // 清空图片\n  images.value = [];\n  \n  //清空标题\n  title.value = '';\n  // 清空文本描述\n  description.value = '';\n  \n  // 重置分类选择\n  selectedCategory.value = '';\n  selectedSubcategory.value = '';\n  selectedCondition.value = '';\n  activeSelector.value = 0;\n  \n  // 清空价格相关\n  price.value = '';\n  originalPrice.value = '';\n  \n  // 重置交易方式\n  tradeMethod.value = '';\n  \n  // 重置可刀设置\n  negotiable.value = '';\n  negotiablePrice.value = '';\n  showPriceInput.value = false;\n  \n  // 关闭所有弹窗\n  pricePopup.value?.close();\n  tradePopup.value?.close();\n  negotiablePopup.value?.close();\n  draftPopup.value?.close();\n};\n\n// 生命周期钩子\nonMounted(() => {\n  // 未登录弹窗提醒；仍启动倒计时，避免弹窗卡住\n  if (!ensureLoggedIn({ content: '登录后才能发布商品', redirectTo: '/pages/mine/mine' })) {\n    startCountdown();\n    return;\n  }\n  // 学生认证与普通会员拦截\n  if (!ensureStudentCertified({ content: '发布商品需先完成学生认证' })) {\n    startCountdown();\n    return;\n  }\n  if (!ensureMembership('normal', { content: '发布商品需普通会员或以上' })) {\n    startCountdown();\n    return;\n  }\n  statusBarHeight.value = getStatusBarHeight(); \n  loadDraftFromStorage(); \n  // 启动倒计时\n  startCountdown();\n}); \n\nonUnmounted(() => {\n  // 组件卸载时清除定时器\n  if (timer) {\n    clearInterval(timer);\n  }\n});\n</script>\n\n<style scoped>\n.container {\n  flex: 1;\n  background-color: #f5f5f5;\n  min-height: 100vh;\n}\n\n/* 导航栏样式 */\n.nav-bar {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  padding: 16rpx 24rpx;\n  background-color: #fff;\n  border-bottom: 1px solid #eee;\n}\n\n.publish-btn {\n  color: #fff;\n  background-color: #FFCC00;\n  border-radius: 30rpx;\n  font-size: 36rpx;\n  width: 100%;\n  margin-top: 15rpx;\n}\n\n/* 图片上传区域 */\n.upload-area {\n  background-color: #fff;\n  border-radius: 16rpx;\n  padding: 24rpx;\n  margin-bottom: 24rpx;\n}\n\n.upload-title {\n  font-size: 32rpx;\n  color: #333;\n  margin-bottom: 20rpx;\n}\n\n.upload-grid {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 20rpx;\n}\n\n.upload-item {\n  width: 160rpx;\n  height: 160rpx;\n  border-radius: 12rpx;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.add-btn {\n  border: 2rpx dashed #ddd;\n  background-color: #fafafa;\n}\n\n.image-item {\n  position: relative;\n  overflow: hidden;\n}\n\n.upload-img {\n  width: 100%;\n  height: 100%;\n}\n\n.delete-btn {\n  position: absolute;\n  top: 0;\n  right: 0;\n  width: 40rpx;\n  height: 40rpx;\n  background-color: rgba(0, 0, 0, 0.5);\n  border-radius: 0 0 0 12rpx;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n/* 输入区域 */\n.input-area1 {\n  background-color: #fff;\n  border-radius: 16rpx;\n  padding: 24rpx;\n  margin-bottom: 24rpx;\n} \n\n.input-area {\n  background-color: #fff;\n  border-radius: 16rpx;\n  padding: 24rpx;\n  margin-bottom: 24rpx;\n}\n\n.desc-input1 {\n  width: 100%;\n  min-height: 40rpx;\n  font-size: 32rpx;\n  line-height: 1.5;\n  text-align: left; /* 新增：文字左对齐 */\n}\n\n.desc-input {\n  width: 100%;\n  min-height: 180rpx;\n  font-size: 32rpx;\n  line-height: 1.5;\n  text-align: left; /* 新增：文字左对齐 */\n}\n\n.word-count {\n  text-align: right;\n  font-size: 28rpx;\n  color: #999;\n  margin-top: 12rpx;\n}\n\n/* 选项列表 */\n.options-list {\n  background-color: #fff;\n  border-radius: 16rpx;\n  overflow: hidden;\n}\n\n.option-item {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 28rpx 24rpx;\n  border-bottom: 1px solid #eee;\n  font-size: 32rpx;\n}\n\n.option-item:last-child {\n  border-bottom: none;\n}\n\n.option-label {\n  color: #333;\n}\n\n.option-value {\n  color: #999;\n  margin-right: 20rpx;\n}\n\n/* 弹窗样式 */\n.custom-popup {\n  width: 100%;\n}\n\n.popup-content {\n  background-color: #fff;\n  border-radius: 24rpx 24rpx 0 0;\n  padding: 32rpx;\n}\n\n.popup-title {\n  font-size: 36rpx;\n  font-weight: 500;\n  text-align: center;\n  margin-bottom: 32rpx;\n  padding-bottom: 24rpx;\n  border-bottom: 1px solid #eee;\n}\n\n/* 价格弹窗 */\n.price-input-container {\n  display: flex;\n  align-items: center;\n  padding: 24rpx;\n  border: 1px solid #eee;\n  border-radius: 12rpx;\n  margin-bottom: 40rpx;\n}\n\n/* 价格标签（售价/原价） */\n.price-label {\n  width: 120rpx;\n  font-size: 32rpx;\n  color: #333;\n}\n\n/* 输入框容器 */\n.price-input-wrapper {\n  flex: 1;\n  display: flex;\n  align-items: center;\n  border-bottom: 2rpx solid #eee;\n  padding-bottom: 40rpx;\n}\n\n.rmb-sign {\n  font-size: 40rpx;\n  color: #333;\n  margin-right: 16rpx;\n}\n\n/* 服务费说明 */\n.service-fee-desc {\n  padding: 20rpx;\n  background-color: #f5f5f5;\n  border-radius: 8rpx;\n}\n\n.fee-rate{\n\tcolor:#00c41d;\n\tmargin-left: 20rpx;\n\tfont-size: 32rpx\n}\n\n.fee-text {\n  font-size: 26rpx;\n  color: #999;\n}\n\n\n.price-input {\n  flex: 1;\n  font-size: 28rpx;\n  height: 80rpx;\n}\n\n.popup-buttons {\n  display: flex;\n  gap: 24rpx;\n}\n\n.popup-buttons button {\n  flex: 1;\n  height: 96rpx;\n  line-height: 96rpx;\n  font-size: 32rpx;\n  border-radius: 12rpx;\n}\n\n.cancel-btn {\n  background-color: #f5f5f5;\n  color: #333;\n}\n\n.confirm-btn {\n  background-color: #FFCC00;\n  color: #fff;\n}\n\n\n/* 交易方式弹窗 */\n.trade-methods {\n  padding-top: 16rpx;\n}\n\n.trade-method {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 28rpx 0;\n  font-size: 32rpx;\n  border-bottom: 1px solid #eee;\n}\n\n.trade-method:last-child {\n  border-bottom: none;\n}\n\n.options {\n  display: flex;\n  justify-content: space-around;\n  margin-bottom: 30rpx;\n}\n\n.option-btn {\n  width: 200rpx;\n  background-color: #f5f5f5;\n  border-radius: 8rpx;\n}\n\n.option-btn:active {\n  background-color: #cccccc;\n}\n\n.price-input-area {\n  display: flex;\n  align-items: center;\n  gap: 10rpx;\n}\n\n.price-input {\n  flex: 1;\n  border: 1px solid #eee;\n  border-radius: 8rpx;\n  padding: 10rpx;\n}\n\n.confirm-price-btn {\n/*  padding: 10rpx 20rpx; */\n  width: 150rpx;\n  text-align: center;\n  background-color: #007aff;\n  color: #fff;\n  border-radius: 8rpx;\n}\n\n/* 选择器容器 */\n.category-selectors {\n  position: relative;\n  width: 100%;\n}\n\n/* 三个选择器一排显示 */\n.select-row {\n  margin: 15rpx ;\n  display: flex;\n  border: 1px solid #eee;\n  border-radius: 8rpx;\n  overflow: hidden;\n  background-color: #fff;\n}\n/* 单个选择器样式 */\n.select-item {\n  flex: 1;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 24rpx 30rpx;\n  font-size: 30rpx;\n  position: relative;\n}\n/* 选择器之间的分隔线 */\n.select-item:not(:last-child)::after {\n  content: '';\n  position: absolute;\n  right: 0;\n  top: 10rpx;\n  height: 60rpx;\n  width: 1px;\n  background-color: #eee;\n}\n/* 选择器值的样式 */\n.select-value {\n  color: #333;\n}\n.select-item:not(.disabled) .select-value {\n  color: #666;\n}\n/* 禁用状态 */\n.disabled {\n  color: #ccc;\n  pointer-events: none;\n}\n/* 箭头旋转动画 */\n.rotate-icon {\n  transform: rotate(180deg);\n  transition: transform 0.3s ease;\n}\n/* 下拉面板 */\n.select-panel {\n  position: absolute;\n  top: 100%;\n  left: 0;\n  right: 0;\n  z-index: 99;\n  max-height: 500rpx;\n  overflow-y: auto;\n}\n.panel-content {\n  background-color: #fff;\n  border: 1px solid #eee;\n  border-top: none;\n  border-radius: 0 0 8rpx 8rpx;\n}\n/* 选项列表 */\n.option-list {\n  display: flex;\n  flex-wrap: wrap;\n}\n/* 选项项 */\n.option-item2 {\n  width: 33.333%;\n  padding: 28rpx 0;\n  text-align: center;\n  font-size: 30rpx;\n  color: #333;\n  border-bottom: 1px solid #eee;\n  border-right: 1px solid #eee;\n  box-sizing: border-box;\n}\n/* 去除最后一列的右边框 */\n.option-item2:nth-child(3n) {\n  border-right: none;\n}\n/* 选项点击效果 */\n.option-item2:active {\n  background-color: #f5f5f5;\n}\n/* 遮罩层 */\n.mask {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: rgba(0, 0, 0, 0.3);\n  z-index: 98;\n}\n\n/* 自定义导航栏样式 */\n.custom-nav {\n  /* 状态栏高度 + 导航栏本身高度 */\n  height: calc(var(--status-bar-height) + 44px);\n  padding-top: var(--status-bar-height);\n  background-color: #ffffff;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  z-index: 999;\n  border-bottom: 1px solid #eee;\n}\n\n.back-btn {\n  position: absolute;\n  left: 16px;\n  width: 44px;\n  height: 44px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.nav-title {\n  font-size: 17px;\n  font-weight: 500;\n  color: #333;\n}\n\n.nav-right {\n  position: absolute;\n  right: 16px;\n  width: 44px;\n  height: 44px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.content {\n  padding-top: calc(var(--status-bar-height) + 32px);\n  padding-left: 16px;\n  padding-right: 16px;\n  padding-bottom: 16px;\n  box-sizing: border-box;\n}\n\n.statusBar {\n  background-color: #fff;\n  width: 100%;\n}\n\n/* 弹窗样式：居中显示，半透明遮罩 */\n.popup-overlay {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: rgba(0, 0, 0, 0.5);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 9999;\n}\n.popup-container {\n  width: 60%;\n  background-color: #fff;\n  border-radius: 24rpx;\n  padding: 40rpx 30rpx;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 30rpx;\n}\n.popup-content {\n  font-size: 24rpx;\n  color: #333;\n  text-align: left; /* 新增：文字左对齐 */\n}\n.popup-close-btn {\n  width: 180rpx;\n  height: 70rpx;\n  line-height: 70rpx;\n  background-color: #007aff;\n  color: #fff;\n  border-radius: 35rpx;\n  font-size: 28rpx;\n  padding: 0;\n}\n.popup-close-btn:disabled {\n  opacity: 0.7;\n  background-color: #ccc;\n  cursor: not-allowed;\n}\n</style>","import MiniProgramPage from 'C:/Users/86133/Desktop/demo/Lezhuan/pages/post/post.vue'\nwx.createPage(MiniProgramPage)"],"names":["useStorage","ref","uni","nextTick","ensureLoggedIn","ensureStudentCertified","ensureMembership","productApi","onBackPress","onMounted","getStatusBarHeight","onUnmounted"],"mappings":"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"}