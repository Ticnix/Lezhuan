{"version":3,"file":"setting.js","sources":["pages/setting/setting.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvc2V0dGluZy9zZXR0aW5nLnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"personal-info-page\">\n    <!-- 顶部背景装饰 -->\n    <view class=\"top-bg\"></view>\n    \n    <!-- 头像区域 -->\n    <view class=\"avatar-section\">\n      <view class=\"avatar-wrapper\" @click=\"chooseAvatar\">\n        <image \n          :src=\"userInfo.avatarUrl || 'https://api.shaolezhuan.cn/lzphoto/avatars/avatar1.jpeg'\" \n          class=\"avatar\"\n          mode=\"aspectFill\"\n        ></image>\n      </view>\n      <text class=\"nickname\">{{ userInfo.nickName || '未设置昵称' }}</text>\n      <text class=\"user-id\">ID: {{ userInfo.studentIdNumber || '请完成学生认证' }}</text>\n    </view>\n    \n    <!-- 信息表单区域 -->\n    <view class=\"info-form\">\n      <!-- 性别选择 -->\n      <view class=\"form-item\">\n        <text class=\"form-label\">性别</text>\n        <view class=\"form-content\">\n          <picker \n            :range=\"genderOptions\" \n            :value=\"genderIndex\" \n            @change=\"onGenderChange\"\n            class=\"form-picker\"\n          >\n            <text>{{ genderOptions[genderIndex] || '请选择' }}</text>\n          </picker>\n        </view>\n      </view>\n      \n      <!-- 校区 -->\n      <view class=\"form-item\">\n        <text class=\"form-label\">校区</text>\n        <view class=\"form-content\">\n          <picker \n            :range=\"campusOptions\" \n            :value=\"campusIndex\" \n            @change=\"onCampusChange\"\n            class=\"form-picker\"\n          >\n            <text>{{ campusOptions[campusIndex] || '请选择' }}</text>\n          </picker>\n        </view>\n      </view>\n      \n      <!-- 宿舍 -->\n      <view class=\"form-item\">\n        <text class=\"form-label\">宿舍</text>\n        <view class=\"form-content\">\n          <picker \n            :range=\"dormitoryOptions\" \n            :value=\"dormitoryIndex\" \n            @change=\"onDormitoryChange\"\n            class=\"form-picker\"\n          >\n            <text>{{ dormitoryOptions[dormitoryIndex] || '请选择' }}</text>\n          </picker>\n        </view>\n      </view>\n      \n      <!-- 专业 -->\n      <view class=\"form-item\">\n        <text class=\"form-label\">专业</text>\n        <view class=\"form-content\">\n          <input \n            v-model=\"userInfo.major\" \n            type=\"text\" \n            placeholder=\"请输入专业\" \n            class=\"form-input\"\n          />\n        </view>\n      </view>\n    </view>\n    \n    <!-- 保存按钮 -->\n    <button class=\"save-btn\" @click=\"saveInfo\">保存信息</button>\n    <!-- 退出登录按钮 -->\n    <button class=\"logout-btn\" @click=\"logout\">退出登录</button>\n  </view>\n</template>\n\n<script setup>\nimport { ref, onMounted } from 'vue';\n\n// 性别选项\nconst genderOptions = ref(['男', '女']);\nconst genderIndex = ref(0);\n\n// 校区选项\nconst campusOptions = ref(['韶乐园校区', '黄田坝校区', '十里亭校区']);\nconst campusIndex = ref(0);\n\n// 宿舍选项\nconst dormitoryOptions = ref([\n  '紫竹苑', '紫薇苑', '紫荆苑', '银杏苑', '丹竹苑',\n  '红枫苑', '丹枫苑', '红棉苑', '碧桂苑', '芙蓉苑',\n  '蔷薇苑', '秋枫苑', '海棠苑', '丁香苑', '樱花苑',\n  '梧桐苑', '金竹苑', '景行苑', '文杏苑', '丹桂苑',\n  '碧桃苑', '紫藤苑'\n]);\nconst dormitoryIndex = ref(0);\n\n// 用户信息\nconst userInfo = ref({\n  avatarUrl: '',\n  nickName: '',\n  studentIdNumber: '',\n  campus: '',\n  dormitory: '',\n  major: ''\n});\n\n// 页面加载时获取已保存的用户信息\nonMounted(() => {\n  // 1. 先读取登录时单独存储的核心信息（优先级更高，避免信息不一致）\n  const storedUserId = uni.getStorageSync('studentIdNumber');\n  const storedNickname = uni.getStorageSync('nickname');\n  const storedAvatarUrl = uni.getStorageSync('avatarUrl');\n  // 2. 再读取之前保存的完整用户信息（如性别、校区等）\n  const storedUser = uni.getStorageSync('userInfo');\n  \n  // 3. 合并信息：核心信息优先，补充其他配置信息\n  userInfo.value = {\n    // 登录时存储的核心字段\n    studentIdNumber: storedUserId || storedUser.studentIdNumber || '',\n    nickName: storedNickname || storedUser.nickName || '',\n    avatarUrl: storedAvatarUrl || storedUser.avatarUrl || '',\n    // 其他配置字段（从userInfo读取）\n    gender: storedUser.gender || '',\n    campus: storedUser.campus || '',\n    dormitory: storedUser.dormitory || '',\n    major: storedUser.major || ''\n  };\n  \n  // 4. 同步选择器状态（保持原逻辑，确保下拉框显示正确）\n  // 同步性别\n  if (userInfo.value.gender) {\n    const genderIdx = genderOptions.value.indexOf(userInfo.value.gender);\n    if (genderIdx!== -1) genderIndex.value = genderIdx;\n  }\n  // 同步校区\n  if (userInfo.value.campus) {\n    const campusIdx = campusOptions.value.indexOf(userInfo.value.campus);\n    if (campusIdx!== -1) campusIndex.value = campusIdx;\n  }\n  // 同步宿舍\n  if (userInfo.value.dormitory) {\n    const dormIdx = dormitoryOptions.value.indexOf(userInfo.value.dormitory);\n    if (dormIdx!== -1) dormitoryIndex.value = dormIdx;\n  }\n});\n\n// 性别选择变化\nconst onGenderChange = (e) => {\n  genderIndex.value = e.detail.value;\n  userInfo.value.gender = genderOptions.value[genderIndex.value];\n};\n\n// 校区选择变化\nconst onCampusChange = (e) => {\n  campusIndex.value = e.detail.value;\n  userInfo.value.campus = campusOptions.value[campusIndex.value];\n};\n\n// 宿舍选择变化\nconst onDormitoryChange = (e) => {\n  dormitoryIndex.value = e.detail.value;\n  userInfo.value.dormitory = dormitoryOptions.value[dormitoryIndex.value];\n};\n\n// 保存信息\nconst saveInfo = () => {\n  // 1. 保存完整用户信息到userInfo存储项\n  uni.setStorageSync('userInfo', userInfo.value);\n  \n  // 2. 同步更新核心字段的单独存储（确保登录相关页面能获取最新值）\n  if (userInfo.value.studentIdNumber) uni.setStorageSync('studentIdNumber', userInfo.value.studentIdNumber);\n  if (userInfo.value.nickName) uni.setStorageSync('nickname', userInfo.value.nickName);\n  if (userInfo.value.avatarUrl) uni.setStorageSync('avatarUrl', userInfo.value.avatarUrl);\n  \n  // 3. 提示与后续逻辑（保持原逻辑）\n  uni.showToast({\n    title: '信息保存成功',\n    icon: 'success'\n  });\n};\n\n// 退出登录\nconst logout = () => {\n  // 显示确认弹窗\n  uni.showModal({\n    title: '退出登录',\n    content: '确定要退出登录吗？',\n    success: (res) => {\n      if (res.confirm) {\n        // 清空缓存\n        uni.clearStorageSync();\n        // 刷新页面（可通过跳转当前页面实现）\n        uni.reLaunch({\n          url: '/pages/setting/setting' // 假设当前页面路径为 /pages/personal/personal\n        });\n      }\n    }\n  });\n};\n</script>\n\n<style scoped>\n.personal-info-page {\n  background-color: #f5f7fa;\n  min-height: 100vh;\n  padding: 0 30rpx;\n}\n\n/* 顶部背景装饰 */\n.top-bg {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  height: 400rpx;\n  /* 垂直方向渐变，从顶部的渐变颜色到底部透明 */\n  background: linear-gradient(to bottom, #bcb0ff, #deb5ff, rgba(123, 97, 255, 0));\n  border-bottom-left-radius: 40rpx;\n  border-bottom-right-radius: 40rpx;\n  z-index: 0;\n}\n\n/* 头像区域 */\n.avatar-section {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  padding-top: 80rpx;\n  position: relative;\n  z-index: 99;\n  margin-bottom: 50rpx;\n}\n\n.avatar-wrapper {\n  position: relative;\n  width: 180rpx;\n  height: 180rpx;\n  border-radius: 50%;\n  overflow: hidden;\n  /* 新增渐变背景 */\n  background: linear-gradient(45deg, #cdc0ff, #9baaff);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-bottom: 20rpx;\n  z-index: 1;\n  /* 新增悬浮动画 */\n  transition: transform 0.3s ease, box-shadow 0.3s ease;\n}\n/* 鼠标悬浮效果（H5 环境下） */\n.avatar-wrapper:hover {\n  transform: scale(1.05);\n  box-shadow: 0 0 20rpx rgba(123, 97, 255, 0.5);\n}\n\n.avatar {\n  width: 95%;\n  height: 95%;\n  border-radius: 50%;\n  z-index: 99;\n  border: 4rpx solid #fff;\n}\n\n.edit-avatar {\n  position: absolute;\n  bottom: 6rpx;\n  right: 6rpx;\n  width: 50rpx;\n  height: 50rpx;\n  background: linear-gradient(90deg, #ff5ca8, #ff8c66);\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border: 4rpx solid #fff;\n  z-index: 100;\n  /* 新增动画 */\n  animation: pulse 2s infinite;\n}\n/* 编辑图标呼吸动画 */\n@keyframes pulse {\n  0% {\n    box-shadow: 0 0 0 0 rgba(255, 92, 168, 0.7);\n  }\n  70% {\n    box-shadow: 0 0 0 10rpx rgba(255, 92, 168, 0);\n  }\n  100% {\n    box-shadow: 0 0 0 0 rgba(255, 92, 168, 0);\n  }\n}\n\n.nickname {\n  font-size: 36rpx;\n  font-weight: bold;\n  color: #333;\n  margin-bottom: 8rpx;\n  /* 新增文字阴影 */\n  text-shadow: 0 2rpx 4rpx rgba(0, 0, 0, 0.1);\n}\n\n.user-id {\n  font-size: 28rpx;\n  color: #666;\n}\n\n/* 表单区域 */\n.info-form {\n  background-color: #fff;\n  border-radius: 20rpx;\n  padding: 0 30rpx;\n  box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.05);\n  position: relative;\n  z-index: 1;\n  /* 新增轻微渐变和悬浮效果 */\n  background: linear-gradient(180deg, #ffffff, #f9f9f9);\n  transition: box-shadow 0.3s ease;\n}\n.info-form:hover {\n  box-shadow: 0 6rpx 18rpx rgba(0, 0, 0, 0.08);\n}\n\n.form-item {\n  display: flex;\n  align-items: center;\n  height: 120rpx;\n  border-bottom: 1rpx solid #f1f1f1;\n}\n\n.form-item:last-child {\n  border-bottom: none;\n}\n\n.form-label {\n  width: 140rpx;\n  font-size: 30rpx;\n  color: #333;\n}\n\n.form-content {\n  flex: 1;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n}\n\n.form-input {\n  width: 100%;\n  font-size: 30rpx;\n  color: #333;\n  padding-right: 30rpx;\n}\n\n.form-picker {\n  width: 100%;\n  font-size: 30rpx;\n  color: #333;\n  padding-right: 30rpx;\n}\n\n/* 保存按钮 */\n.save-btn {\n  width: 100%;\n  height: 100rpx;\n  background: linear-gradient(90deg, #aca4ff 0%, #e1bdff 100%);\n  color: #fff;\n  font-size: 32rpx;\n  border-radius: 50rpx;\n  margin-top: 60rpx;\n  box-shadow: 0 6rpx 16rpx rgba(123, 97, 255, 0.3);\n  /* 新增按钮悬浮效果 */\n  transition: transform 0.3s ease, box-shadow 0.3s ease;\n  margin-bottom: 20rpx;\n}\n.save-btn:hover {\n  transform: translateY(-3rpx);\n  box-shadow: 0 8rpx 20rpx rgba(123, 97, 255, 0.4);\n}\n\n/* 退出登录按钮 */\n.logout-btn {\n  width: 100%;\n  height: 100rpx;\n  background-color: #ff6b6b;\n  color: #fff;\n  font-size: 32rpx;\n  border-radius: 50rpx;\n  margin-top: 0;\n  box-shadow: 0 6rpx 16rpx rgba(255, 107, 107, 0.3);\n  transition: transform 0.3s ease, box-shadow 0.3s ease;\n}\n.logout-btn:hover {\n  transform: translateY(-3rpx);\n  box-shadow: 0 8rpx 20rpx rgba(255, 107, 107, 0.4);\n}\n</style>","import MiniProgramPage from 'C:/Users/86133/Desktop/demo/Lezhuan/pages/setting/setting.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","onMounted","uni"],"mappings":"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"}