{"version":3,"file":"student.js","sources":["pages/student/student.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvc3R1ZGVudC9zdHVkZW50LnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"student-auth-page\">\n    <!-- 顶部装饰背景 -->\n    <view class=\"top-decor\"></view>\n\n    <!-- 标题区域 -->\n    <view class=\"page-header\">\n      <text class=\"title\">学生认证</text>\n      <text class=\"subtitle\">完成认证可解锁校园专属功能</text>\n    </view>\n\n    <!-- 认证表单区域 -->\n    <view class=\"auth-form\">\n      <!-- 学校输入 -->\n      <view class=\"form-item\">\n        <text class=\"form-label\">所在学校</text>\n        <view class=\"form-control\">\n          <input \n            v-model=\"studentInfo.university\" \n            type=\"text\" \n            placeholder=\"请输入学校全称\" \n            class=\"input-control\"\n            @input=\"handleUniversityInput\"\n          />\n        </view>\n      </view>\n\n      <!-- 学院选择 -->\n      <view class=\"form-item\">\n        <text class=\"form-label\">所属学院</text>\n        <view class=\"form-control\">\n          <picker \n            :range=\"collegeOptions\" \n            :value=\"collegeIndex\" \n            @change=\"handleCollegeChange\"\n            class=\"picker-control\"\n          >\n          <text class=\"picker-text\">{{ collegeOptions[collegeIndex] || '请选择学院' }}</text>\n          </picker>\n        </view>\n      </view>\n\n      <!-- 专业输入 -->\n      <view class=\"form-item\">\n        <text class=\"form-label\">所学专业</text>\n        <view class=\"form-control\">\n          <input \n            v-model=\"studentInfo.major\" \n            type=\"text\" \n            placeholder=\"请输入专业全称\" \n            class=\"input-control\"\n            @input=\"handleMajorInput\"\n          />\n        </view>\n      </view>\n\n      <!-- 学号输入 -->\n      <view class=\"form-item\">\n        <text class=\"form-label\">学号</text>\n        <view class=\"form-control\">\n          <input \n            v-model=\"studentInfo.studentIdNumber\" \n            type=\"text\" \n            placeholder=\"请输入你的学号\" \n            class=\"input-control\"\n            @input=\"handleStudentIdInput\"\n          />\n        </view>\n      </view>\n\n      <!-- 学生证上传 -->\n      <view class=\"form-item upload-item\">\n        <text class=\"form-label\">学生证照片</text>\n        <button \n          class=\"upload-container\" \n          @click.stop=\"chooseStudentCard\"\n          hover-class=\"upload-hover\"\n        >\n          <!-- 上传预览区 -->\n          <view class=\"upload-preview\">\n            <image \n              :src=\"studentInfo.idCardUrl \" \n              class=\"preview-img\"\n              mode=\"aspectFill\"\n            ></image>\n            <!-- 上传提示图标 -->\n            <view class=\"upload-tip\" v-if=\"!studentInfo.idCardUrl\">\n              <uni-icons type=\"plus\" size=\"36\" color=\"#666\"></uni-icons>\n              <text class=\"tip-text\">点击上传</text>\n            </view>\n            <!-- 已上传状态标识 -->\n            <view class=\"uploaded-tag\" v-if=\"studentInfo.idCardUrl\">\n              <uni-icons type=\"success\" size=\"20\" color=\"#fff\"></uni-icons>\n              <text class=\"tag-text\">已上传</text>\n            </view>\n          </view>\n          <text class=\"upload-hint\">支持学生证封面/内页，清晰展示姓名、学号信息</text>\n        </button>\n      </view>\n    </view>\n\n    <!-- 提交按钮 -->\n    <button \n      class=\"submit-btn\" \n      @click=\"submitAuth\"\n      :disabled=\"!isFormValid || isSubmitting\"\n    >\n      <!-- 提交中状态显示加载图标 -->\n      <uni-icons type=\"loading\" size=\"24\" color=\"#fff\" v-if=\"isSubmitting\"></uni-icons>\n      <text v-if=\"isSubmitting\">提交中...</text>\n      <text v-else>提交认证</text>\n    </button>\n\n    <!-- 认证说明 -->\n    <view class=\"auth-note\">\n      <text class=\"note-text\">• 认证信息将严格保密，仅用于校园身份核验</text>\n      <text class=\"note-text\">• 提交后将在1-2个工作日内审核完成</text>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, computed, onMounted } from 'vue';\nimport userApi from '@/api/user.js'; // 假设该API文件存在提交认证的接口\nimport { useStorage } from '@/hooks/useStorage';\nimport { ensureLoggedIn } from '@/utils/uniHelper';\n\n// 存储相关\nconst { getStorage } = useStorage();\n\n// 学院选项（修复原数组中的空值）\nconst collegeOptions = ref([\n  '请选择学院', \n  '文学与传媒学院', \n  '外国语学院',\n  '旅游与地理学院',\n  '生物与农业学院',\n  '数学与统计学院', \n  '智能工程学院', \n  '化学与土木工程学院', \n  '教育科学学院', \n  '信息工程学院', \n  '商学院', \n  '政法学院', \n  '音乐与舞蹈学院', \n  '美术与设计学院', \n  '体育学院',\n  '医学院',\n  '食品学院',\n  '马克思主义学院'\n]);\n\nconst collegeIndex = ref(0); // 初始化为0（默认显示“请选择学院”）\nconst isSubmitting = ref(false); // 提交中状态（防止重复提交）\n\n// 学生认证信息\nconst studentInfo = ref({\n  university: '',      // 学校\n  college: '',         // 所属学院\n  major: '',           // 专业\n  studentIdNumber: '', // 学号\n  idCardUrl: '',       // 学生证照片临时路径\n  // idCardServerUrl: ''  // 服务器返回的图片永久URL（用于提交）\n});\n\n// 1. 学院选择处理（修复：仅选择有效学院时才赋值）\nconst handleCollegeChange = (e) => {\n  collegeIndex.value = e.detail.value;\n  // 排除“请选择学院”（索引0），仅赋值有效学院\n  if (collegeIndex.value > 0) {\n    studentInfo.value.college = collegeOptions.value[collegeIndex.value];\n  } else {\n    studentInfo.value.college = '';\n  }\n};\n\n// 2. 输入框处理（保持原逻辑，确保去空格）\nconst handleUniversityInput = (e) => {\n  studentInfo.value.university = e.detail.value.trim();\n};\n\nconst handleMajorInput = (e) => {\n  studentInfo.value.major = e.detail.value.trim();\n};\n\nconst handleStudentIdInput = (e) => {\n  studentInfo.value.studentIdNumber = e.detail.value.trim();\n};\n\n// 选择学生证照片：仅存储临时路径\nconst chooseStudentCard = () => {\n  uni.chooseImage({\n    count: 1,\n    sizeType: ['compressed'], \n    sourceType: ['album', 'camera'],\n    success: (res) => {\n      studentInfo.value.idCardUrl = res.tempFilePaths[0]; // 存储本地临时路径\n      uni.showToast({\n        title: '图片选择成功',\n        icon: 'success',\n        duration: 1500\n      });\n    },\n    fail: () => {\n      uni.showToast({\n        title: '图片选择失败，请重试',\n        icon: 'none',\n        duration: 1500\n      });\n    }\n  });\n};\n\n// 页面进入拦截：未登录引导去登录\nonMounted(() => {\n  ensureLoggedIn({ content: '请先登录再进行学生认证', redirectTo: '/pages/mine/mine' });\n});\n\nconst submitAuth = async () => {\n  if (isSubmitting.value) return;\n\n  try {\n    isSubmitting.value = true;\n\n    // 校验表单（确保所有必填项非空）\n    if (!isFormValid.value) {\n      uni.showToast({ title: '请完善所有必填信息', icon: 'none' });\n      isSubmitting.value = false;\n      return;\n    }\n\n    // 组装 formData 并提交（文本参数 + 文件）\n    const userId = getStorage('userId');\n    const token = getStorage('token');\n\n    const uploadTask = uni.uploadFile({\n      url: 'https://api.shaolezhuan.cn/student-verifications/submit', // 后端认证接口地址\n      filePath: studentInfo.value.idCardUrl, // 本地临时文件路径\n      name: 'cardPhoto', // 与后端参数名一致（formData 中的文件字段）\n      formData: {\n        university: studentInfo.value.university,\n        college: studentInfo.value.college,\n        major: studentInfo.value.major,\n        studentIdNumber: studentInfo.value.studentIdNumber,\n        userId: userId // 若后端需要用户ID，需传入\n      },\n      header: {\n        'Authorization': token ? `Bearer ${token}` : '' // 携带Token（若需要）\n      },\n      success: (res) => {\n        console.log('认证提交响应：', res);\n        let data;\n        try {\n          data = JSON.parse(res.data);\n        } catch (e) {\n          uni.showToast({ title: '服务器响应格式错误', icon: 'none' });\n          return;\n        }\n        if (data.code === 200) {\n          uni.showToast({\n            title: '认证提交成功，等待审核',\n            icon: 'success',\n            duration: 2000\n          });\n          setTimeout(() => {\n            uni.navigateBack();\n          }, 2000);\n        } else {\n          uni.showToast({\n            title: data.msg || '认证提交失败',\n            icon: 'none'\n          });\n        }\n      },\n      fail: (err) => {\n        console.error('认证提交失败：', err);\n        uni.showToast({\n          title: '提交失败，请重试',\n          icon: 'none'\n        });\n      },\n      complete: () => {\n        isSubmitting.value = false;\n      }\n    });\n\n  } catch (err) {\n    console.error('认证提交异常：', err);\n    uni.showToast({\n      title: '提交异常，请稍后重试',\n      icon: 'none'\n    });\n    isSubmitting.value = false;\n  }\n};\n\n// 表单验证：校验本地临时文件路径是否存在\nconst isFormValid = computed(() => {\n  return !!studentInfo.value.university && \n         !!studentInfo.value.college &&    \n         !!studentInfo.value.major &&      \n         !!studentInfo.value.studentIdNumber && \n         !!studentInfo.value.idCardUrl; // 校验本地临时文件路径\n});\n</script>\n\n<style scoped>\n/* 页面基础样式 */\n.student-auth-page {\n  background-color: #f5f7fa;\n  min-height: 100vh;\n  padding: 0 30rpx;\n  position: relative;\n}\n\n/* 顶部装饰背景 */\n.top-decor {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  height: 480rpx;\n  background: linear-gradient(135deg, #7c89ff, #a594ff, #d1b8ff);\n  border-bottom-left-radius: 60rpx;\n  border-bottom-right-radius: 60rpx;\n  z-index: 0;\n}\n\n/* 标题区域 */\n.page-header {\n  padding-top: 90rpx;\n  margin-bottom: 50rpx;\n  position: relative;\n  z-index: 1;\n  text-align: center;\n}\n\n.title {\n  font-size: 42rpx;\n  font-weight: 600;\n  color: #fff;\n  margin-bottom: 12rpx;\n  text-shadow: 0 3rpx 6rpx rgba(0, 0, 0, 0.1);\n  display: block;\n}\n\n.subtitle {\n  font-size: 24rpx;\n  color: rgba(255, 255, 255, 0.9);\n}\n\n/* 认证表单区域 */\n.auth-form {\n  background-color: #fff;\n  border-radius: 30rpx;\n  padding: 45rpx 30rpx;\n  box-shadow: 0 8rpx 24rpx rgba(0, 0, 0, 0.05);\n  margin-bottom: 50rpx;\n  position: relative;\n  z-index: 1;\n  background: linear-gradient(180deg, #ffffff, #fefeff);\n}\n\n/* 表单项基础样式 */\n.form-item {\n  display: flex;\n  flex-direction: column;\n  margin-bottom: 45rpx;\n}\n\n.form-item:last-child {\n  margin-bottom: 0;\n}\n\n.form-label {\n  font-size: 28rpx;\n  color: #333;\n  margin-bottom: 16rpx;\n  font-weight: 500;\n}\n\n.form-control {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  height: 80rpx;\n  border-bottom: 1rpx solid #f2f2f2;\n  transition: border-color 0.3s ease;\n}\n\n.form-control:focus-within {\n  border-color: #a594ff;\n}\n\n/* 学院选择器样式 */\n.picker-control {\n  flex: 1;\n  height: 100%;\n  display: flex;\n  align-items: center;\n}\n\n.picker-text {\n  font-size: 28rpx;\n  color: #666;\n}\n\n/* 输入框样式 */\n.input-control {\n  flex: 1;\n  font-size: 28rpx;\n  color: #333;\n  height: 100%;\n  padding-right: 10rpx;\n}\n\n.input-control::placeholder {\n  color: #ccc;\n  font-size: 26rpx;\n}\n\n/* 学生证上传区域 */\n.upload-item {\n  margin-bottom: 0;\n}\n\n.upload-container {\n  width: 100%;\n  display: flex;\n  flex-direction: column;\n  background: transparent;\n  padding: 0;\n  margin: 0;\n  border: none;\n}\n\n.upload-preview {\n  width: 100%;\n  height: 260rpx;\n  border-radius: 20rpx;\n  overflow: hidden;\n  border: 2rpx dashed #eee;\n  position: relative;\n  margin-bottom: 16rpx;\n  transition: all 0.3s ease;\n}\n\n.upload-hover.upload-preview {\n  border-color: #8c9aff;\n  background-color: rgba(140, 154, 255, 0.05);\n}\n\n.preview-img {\n  width: 100%;\n  height: 100%;\n}\n\n/* 上传提示 */\n.upload-tip {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  background-color: rgba(255, 255, 255, 0.8);\n}\n\n.tip-text {\n  font-size: 24rpx;\n  color: #999;\n  margin-top: 12rpx;\n}\n\n/* 已上传标识 */\n.uploaded-tag {\n  position: absolute;\n  top: 20rpx;\n  right: 20rpx;\n  background-color: rgba(67, 181, 72, 0.9);\n  color: #fff;\n  font-size: 22rpx;\n  padding: 8rpx 16rpx;\n  border-radius: 20rpx;\n  display: flex;\n  align-items: center;\n  gap: 8rpx;\n}\n\n/* 上传提示文本 */\n.upload-hint {\n  font-size: 22rpx;\n  color: #999;\n  line-height: 1.5;\n  text-align: left;\n  margin: 10rpx auto;\n}\n\n/* 提交按钮样式 */\n.submit-btn {\n  width: 100%;\n  height: 100rpx;\n  background: linear-gradient(90deg, #7c89ff, #a594ff);\n  color: #fff;\n  font-size: 32rpx;\n  font-weight: 500;\n  border-radius: 50rpx;\n  box-shadow: 0 8rpx 24rpx rgba(124, 137, 255, 0.3);\n  transition: all 0.3s ease;\n  margin-bottom: 30rpx;\n}\n\n.submit-btn:disabled {\n  background: #e5e5e5;\n  color: #999;\n  box-shadow: none;\n}\n\n.submit-btn:not(:disabled):hover {\n  transform: translateY(-3rpx);\n  box-shadow: 0 12rpx 30rpx rgba(124, 137, 255, 0.4);\n}\n\n/* 认证说明 */\n.auth-note {\n  margin-top: 0;\n  padding-bottom: 50rpx;\n  position: relative;\n  z-index: 1;\n}\n\n.note-text {\n  display: block;\n  font-size: 22rpx;\n  color: #999;\n  margin-bottom: 12rpx;\n  line-height: 1.5;\n}\n</style>\n    ","import MiniProgramPage from 'C:/Users/86133/Desktop/demo/Lezhuan/pages/student/student.vue'\nwx.createPage(MiniProgramPage)"],"names":["useStorage","ref","uni","onMounted","ensureLoggedIn","computed"],"mappings":"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"}