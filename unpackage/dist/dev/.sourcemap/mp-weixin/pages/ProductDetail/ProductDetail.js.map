{"version":3,"file":"ProductDetail.js","sources":["pages/ProductDetail/ProductDetail.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvUHJvZHVjdERldGFpbC9Qcm9kdWN0RGV0YWlsLnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"product-detail-page\">\n    <!-- 用户信息 -->\n    <view class=\"seller-info-container\">\n      <image \n        :src=\"detail?.requester?.avatar || detail?.sellerAvatarUrl || 'https://api.shaolezhuan.cn/lzphoto/avatars/avatar1.jpeg'\" \n        mode=\"widthFix\" \n        class=\"seller-avatar\"\n      ></image>\n      <text class=\"seller-name\">\n\t   {{ detail?.requester?.nickname || detail?.sellerNickname || '未知用户' }}\n\t  </text>\n      <view class=\"credit-tag\">\n\t  {{ detailType === 'demand' \n\t  \t\t? (detail?.requester?.credittag || '买家信用优秀') \n\t  \t\t: (detail?.user?.credittag || '卖家信用优秀') \n\t  }}\n\t  </view>\n    </view>\n\n    <!-- 商品信息 -->\n    <view class=\"product-info\">\n      <!-- 价格 -->\n      <view class=\"price-container\">\n\t\t<text v-if=\"type==='demand'\" class=\"name\">预算:</text>\n        <text class=\"price-symbol\">¥</text>\n        <text class=\"price\">\n\t\t   {{ detailType === 'demand' ? (detail?.budget || '0.00') : (detail?.price || '0.00') }}\n\t\t</text>\n        <text class=\"original-price\" v-if=\"detailType === 'product' && detail?.originalPrice\">\n            ¥{{ detail?.originalPrice }}\n        </text>\n      </view>\n      \n\t  <!-- 可刀展示 -->\n\t  <div class=\"discount-tag\" v-if=\"detailType === 'product' && detail?.isNegotiable\">\n\t    <span class=\"bold-text\">小刀优惠</span> \n\t\t最高可刀 ¥{{ detail?.maxNegotiableAmount || 0 }}\n\t  </div>\n\t  \n      <!-- 标题 -->\n      <text class=\"product-title\" >{{ detail?.title || '商品标题' }}</text>\n    </view>\n\n    <!-- 商品详情 -->\n    <view class=\"product-detail-section\">\n      <view class=\"section-title\">\n\t\t  {{ detailType === 'demand' ? '需求详情' : '商品详情' }}\n\t  </view>\n      <view class=\"detail-content\">\n        <text class=\"product-desc\">{{ detail?.description || detail?.desc || '暂无描述' }}</text>\n        \n        <!-- 详情图片 -->\n        <view class=\"detail-images\" v-if=\"detailType !== 'demand' && allProductImages.length\">\n           <image \n             v-for=\"(img, index) in allProductImages\" \n             :key=\"index\"\n             :src=\"img\" \n             mode=\"widthFix\" \n             class=\"detail-image\"\n             @click=\"previewImages(index)\"\n           ></image>\n        </view>\n      </view>\n    </view>\n\n    <!-- 商家信息及在售商品 -->\n    <view class=\"seller-section\">\n      <view class=\"section-title\">\n\t\t  {{ detailType === 'demand' ? '发布者信息' : '商家信息' }}\n\t  </view>\n      \n      <!-- 商家信息 -->\n      <view class=\"seller-info\">\n        <image \n          :src=\"detail?.requester?.avatar || detail?.sellerAvatarUrl || 'https://api.shaolezhuan.cn/lzphoto/avatars/avatar1.jpeg'\" \n          mode=\"widthFix\" \n          class=\"seller-avatar-large\"\n        ></image>\n        <view class=\"seller-details\">\n          <text class=\"seller-name\">{{ detail?.requester?.nickname || detail?.sellerNickname || '未知用户' }}</text>\n          <text class=\"seller-goods-count\">\n\t\t\t  {{ detailType === 'demand' \n\t\t\t\t? `发布 ${sellerDemands.length} 条需求` \n\t\t\t\t: `在售 ${sellerProducts.length} 件商品` \n\t\t\t  }}\n\t\t  </text>\n        </view>\n\t\t  <view class=\"action-buttons\">\n\t\t    <button class=\"report-btn\" @click=\"showReportDialog = true\" >\n\t\t      举报\n\t\t    </button>\n\t\t    <button class=\"contact-seller\" @click=\"goToChat()\" >聊一聊</button>\n\t\t  </view>\n      </view>\n      \n\t    <!-- 举报弹窗 -->\n\t    <view class=\"report-dialog\" v-if=\"showReportDialog\">\n\t      <view class=\"dialog-mask\" @click=\"showReportDialog = false\"></view>\n\t      <view class=\"dialog-content\">\n\t        <view class=\"dialog-title\">提交举报</view>\n\t        <view class=\"dialog-form\">\n\t          <text class=\"form-label\">举报原因</text>\n\t          <textarea \n\t            v-model=\"reportReason\" \n\t            class=\"form-input\" \n\t            placeholder=\"请输入举报原因（必填）\"\n\t            auto-height\n\t          ></textarea>\n\t        </view>\n\t        <view class=\"dialog-footer\">\n\t          <button class=\"cancel-btn\" @click=\"showReportDialog = false\">取消</button>\n\t          <button class=\"confirm-btn\" @click=\"submitReport\">提交</button>\n\t        </view>\n\t      </view>\n\t    </view>\n\t  \n      <!-- 商家在售商品 -->\n      <view class=\"seller-goods\">\n        <view class=\"seller-goods-title\">\n\t\t\t{{ detailType === 'demand' ? '该发布者其他需求' : '该商家其他商品' }}\n\t\t</view>\n        \n        <view class=\"goods-scroll-container\">\n          <scroll-view class=\"goods-scroll\" scroll-x>\n            <view class=\"goods-list\" v-if=\"Array.isArray(getCurrentRelatedList())\">\n              <navigator\n                v-for=\"(item, index) in getCurrentRelatedList()\" \n                :key=\"item.id\"\n                :url=\"`/pages/ProductDetail/ProductDetail?id=${item.id}&type=${detailType}`\"\n                class=\"goods-item\"\n\t\t\t\t@click=\"goToDetail(item.id, detailType)\"\n              >\n                <image \n                  :src=\"item.imgUrl || 'https://api.shaolezhuan.cn/lzphoto/productDefault.jpg'\" \n                  mode=\"aspectFill\" \n                  class=\"goods-image\"\n                ></image>\n                <text class=\"goods-price\">\n\t\t\t\t\t¥{{ detailType === 'demand' ? item.budget : item.price }}\n\t\t\t\t</text>\n              </navigator>\n              \n              <view class=\"no-more-seller-goods\" v-if=\"getCurrentRelatedList().length === 0\">\n                 {{ detailType === 'demand' ? '该发布者暂无其他需求' : '该商家暂无其他商品' }}\n              </view>         \n            </view>\n          </scroll-view>\n        </view>\n      </view>\n    </view>\n\n    <!-- 逛了又逛 -->\n    <view class=\"recommendation-section\">\n      <view class=\"section-title\">逛了又逛</view>\n      <Waterfall\n        :list=\"detailType === 'demand' ? demandRecommendations : goodsRecommendations\"\n        :columnCount=\"2\"\n        :gap=\"20\"\n      />\n\t  <!-- 滚动到底提醒 -->\n\t  <view v-if=\"hasReachedBottom\" class=\"bottom-reminder\">\n\t    已经到底啦~ 没有更多推荐商品了\n\t  </view>\n    </view>\n\t\n\t<!-- 状态栏占位 -->\n\t<view class=\"statusBar\" ></view>\n\n\t<!-- 底部操作栏 -->\n\t<view class=\"bottom-bar\">\n\t  <!-- 收藏按钮容器 -->\n\t  <view class=\"collect-btn-container\">\n\t\t<!-- uni-fav 组件使用 -->\n\t\t<uni-fav \n\t\t  :checked=\"isCollected\"  \n\t\t  class=\"favBtn\" \n\t\t  circle=\"true\"  \n\t\t  bgColor=\"#f5f5f5\"  \n\t\t  bgColorChecked=\"#ff4d4f\" \n\t\t  color=\"#666\"  \n\t\t  colorChecked=\"#fff\" \n\t\t  size=\"24\"  \n\t\t  @click=\"toggleCollect\" \n\t\t/>\n\t  </view>\n\t  <!-- 聊一聊按钮 -->\n\t  <button class=\"chat-btn\" @click=\"goToChat()\" >\n\t\t<text>聊一聊</text>\n\t  </button>\n\t</view>\n\t\n  </view>\n</template>\n\n<script setup>\nimport { ref, onMounted, computed, onUnmounted } from 'vue';\nimport { onReachBottom, onLoad } from '@dcloudio/uni-app';\nimport Waterfall from '@/components/Waterfall.vue';\nimport productApi from '@/api/product.js';\nimport userApi from '@/api/user.js';\nimport { sanitizeImageUrl, ensureLoggedIn, ensureStudentCertified, ensureMembership } from '@/utils/uniHelper';\n\n// 1. 核心数据存储\nconst detail = ref({}); // 统一存储需求/商品数据\nconst isCollected = ref(false); // 通用：收藏状态\nconst hasReachedBottom = ref(false); // 通用：滚动到底标记\nconst uglyDemandList = ref([]);\nconst uglyGoodsList = ref([]);\nconst demandRecommendations = ref([]); // 单独存储需求推荐\nconst goodsRecommendations = ref([]);  // 单独存储商品推荐\nconst sellerDemands = ref([]);//需求专属：商家其他需求\nconst sellerProducts = ref([]); // 商品专属：商家其他商品\nconst showReportDialog = ref(false);// 举报弹窗状态\nconst reportReason = ref('');// 举报原因\n// const currentRelatedList = computed(() => {\n//   return detailType === 'demand' ? sellerDemands.value : sellerProducts.value;\n// });\n// const currentRelatedList= () => {\n//   return getCurrentRelatedList();\n// };\n// 记录浏览开始时间和是否已提交\nconst hasReported = ref(false); // 避免重复提交\n\nlet detailId = '';\nlet detailType = '';\n\nconst getCurrentRelatedList = () => {\n  // 实时判断类型，返回对应的列表\n  if (detailType === 'demand') {\n    return sellerDemands.value;\n  } else {\n    return sellerProducts.value;\n  }\n};\n\nconst type=ref()\nonLoad((options) => {\n  detailId = options.id || ''; \n  detailType = options.type || 'product';\n  type.value=detailType\n  // 页面加载时查询收藏状态\n  fetchFavoriteStatus();\n});\n\n//页面挂载时校验类型，加载需求数据\nonMounted(() => {\n  reportBrowseHistory();\n  console.log('商品ID:',detailId)\n  console.log('商品类型：',detailType)\n  if (!detailId) {\n      uni.showToast({ title: '参数错误', icon: 'none' });\n      setTimeout(() => uni.navigateBack(), 1500);\n      return;\n    }\n  // type=demand\n  if (detailType === 'demand') {\n    fetchDemandDetail(detailId); // 需求详情\n\tfetchDemandRecommendations();// 获取首页推荐需求\n  } else {\n    fetchProductDetail(detailId); // 商品详情\n\tfetchProductRecommendations();// 获取首页推荐商品\n  }\n});\n\n// 提交浏览记录的函数\nconst reportBrowseHistory = async () => {\n  if (hasReported.value || !detailId) return; // 避免重复提交或无ID时提交\n\n  // 构造请求参数（符合接口要求）\n  const params = {\n      itemId: Number(detailId), \n      itemType: detailType, // 'product'或'demand'\n  };\n  console.log('浏览记录提交的数据：', params);\n\n  try {\n    const res = await userApi.recordBrowseHistory(params);\n    if (res.code === 200) {\n      console.log('浏览记录提交成功', res.data);\n    } else {\n      console.warn('浏览记录提交失败', res.msg);\n    }\n  } catch (error) {\n    console.error('浏览记录接口调用失败', error);\n  } finally {\n    hasReported.value = true;\n  }\n};\n\n// // 监听页面卸载\n// onUnmounted(() => {\n//   reportBrowseHistory();\n// });\n\n//需求数据加载（专属）\nconst fetchDemandDetail = async (detailId) => {\n  try {\n    // 调用后端接口，传入需求ID\n    const res = await productApi.getDemandDetail(detailId);\n    if (res.code === 200) {\n      const raw = res.data;\n      // 统一兼容 detailImages 为数组或逗号分隔字符串\n      const parseDetailImages = (imgs, type) => {\n        let arr = [];\n        if (Array.isArray(imgs)) arr = imgs;\n        else if (typeof imgs === 'string') {\n          arr = imgs.split(',').map(s => s.trim()).filter(Boolean);\n        }\n        return arr.map(u => sanitizeImageUrl(u, type));\n      };\n      detail.value = {\n        ...raw,\n        imgUrl: sanitizeImageUrl(raw?.mainImageUrl, 'demand'),\n        requester: {\n          ...(raw?.requester || {}),\n          avatar: sanitizeImageUrl(raw?.requester?.avatar, 'avatar'),\n          nickname: raw?.requester?.nickname || '未知用户'\n        },\n        sellerAvatarUrl: sanitizeImageUrl(raw?.sellerAvatarUrl, 'avatar'),\n        detailImages: parseDetailImages(raw?.detailImages, 'demand')\n      };\n\t  console.log('得到详细的需求数据是：',detail.value)\n\t  await fetchSellerDemands(raw?.requester?.id)\n    } else {\n      uni.showToast({ title: res.msg || '获取需求失败', icon: 'none' });\n    }\n  } catch (error) {\n    // 网络错误/代码异常\n    console.error('需求加载失败:', error);\n    uni.showToast({ title: '网络错误，请重试', icon: 'none' });\n  }\n};\n\n//商品数据加载（专属）\nconst fetchProductDetail = async (id) => {\n  try {\n    // 调用后端接口，传入商品ID\n    const res = await productApi.getProductDetail(id);\n    if (res.code === 200) {\n      const raw = res.data;\n      // 统一兼容 detailImages 为数组或逗号分隔字符串\n      const parseDetailImages = (imgs, type) => {\n        let arr = [];\n        if (Array.isArray(imgs)) arr = imgs;\n        else if (typeof imgs === 'string') {\n          arr = imgs.split(',').map(s => s.trim()).filter(Boolean);\n        }\n        return arr.map(u => sanitizeImageUrl(u, type));\n      };\n      detail.value = {\n        ...raw,\n        imgUrl: sanitizeImageUrl(raw?.mainImageUrl, 'product'),\n        sellerAvatarUrl: sanitizeImageUrl(raw?.sellerAvatarUrl, 'avatar'),\n        detailImages: parseDetailImages(raw?.detailImages, 'product')\n      };\n\t  await fetchSellerProducts(raw?.sellerId)\n\t  console.log('得到详细的商品数据是：',detail.value)\n    } else {\n      uni.showToast({ title: res.msg || '获取商品失败', icon: 'none' });\n    }\n  } catch (error) {\n    // 网络错误/代码异常\n    console.error('商品加载失败:', error);\n    uni.showToast({ title: '网络错误，请重试', icon: 'none' });\n  }\n};\n\nconst fetchSellerDemands = async (requesterId) => {\n  try {\n    const res = await productApi.getSellerItem(requesterId);\n    console.log('接口返回的发布者其他需求：', res.data.demands);\n    if (res.code === 200) {\n      sellerDemands.value = res.data.demands\n        .filter(item => item.id !== detail.value.id)\n        .map(item => ({\n          ...item,\n          imgUrl: sanitizeImageUrl(item.mainImageUrl || item.imgUrl, 'demand'),\n          budget: item.budget || '0.00',\n        }));\n      // 关键：打印 detailType 和 currentRelatedList 的来源\n      console.log('当前 detailType：', detailType); \n      console.log('sellerDemands 长度：', sellerDemands.value.length);\n      console.log('getCurrentRelatedList() 实际值：', \n        detailType === 'demand' ? '来自 sellerDemands' : '来自 sellerProducts'\n      );\n\t   console.log('currentRelatedList为',getCurrentRelatedList())\n    }\n  } catch (error) {\n    console.error('获取发布者其他需求失败:', error);\n  }\n};\n\n// 获取该用户发布的所有商品\nconst fetchSellerProducts = async (requesterId) => {\n  try {\n    const res = await productApi.getSellerItem(requesterId);\n\tconsole.log('接口返回的发布者其他商品：', res.data.demands);\n    if (res.code === 200) {\n      sellerProducts.value = res.data.products\n        .filter(item => item.id !== detail.value.id) // 排除当前商品\n        .map(item => ({\n          ...item,\n          imgUrl: sanitizeImageUrl(item.mainImageUrl || item.imgUrl, 'product'),\n          price: item.price || 0\n        }));\n\t  console.log('后端返回给获取该商家的所有商品数据：',sellerProducts.value)\n    }\n  } catch (error) {\n    console.error('获取发布者其他需求失败:', error);\n  }\n};\n\n//获取推荐需求接口\nconst fetchDemandRecommendations = async () => {\n\ttry {\n\t  // 请求需求数据\n\t  const demandRes = await productApi.getAllDemands();\n\t\tconsole.log('接口获取的所有需求推荐数据',demandRes.data)\n\t  \n\t  // 处理需求数据\n\t  if (demandRes.code === 200) {\n\t    uglyDemandList.value = demandRes.data || [];\n\t\tawait cleanDemandList();\n\t\tconsole.log('获取推荐需求的脏数据：',uglyDemandList.value)\n\t  } else {\n\t    uni.showToast('获取需求数据失败');\n\t  }\n\t} catch (error) {\n\t  console.error('获取推荐数据失败：', error);\n\t  uni.showToast('网络异常，获取推荐数据失败');\n\t}\n};\n\n//获取推荐商品接口\nconst fetchProductRecommendations = async () => {\n  try {\n      const productRes = await productApi.getAllGoods();\n  \tif (productRes.code === 200) {\n        console.log('后端返回的对应分类推荐商品为：', productRes.data)\n  \t  uglyGoodsList.value = productRes.data || [];\n  \t  cleanGoodsList();\n      } else {\n        uni.showToast({\n          title: productRes.message || '获取商品列表失败',\n          icon: 'none'\n        });\n        goodsRecommendations.value = [];\n      }\n    } catch (error) {\n      uni.showToast({\n        title: '网络异常，获取商品列表失败',\n        icon: 'none'\n      });\n      console.error('获取商品列表失败：', error);\n      goodsList.value = [];\n    }\n};\n\n//清洗函数（需求）\nconst cleanDemandList = async () => {\n  console.log('清洗前的需求数据：', uglyDemandList.value);\n  const tempDemandList = await Promise.all(\n    uglyDemandList.value.map(async (item) => {\n      let tags = [];\n      try {\n        const attributesObj = JSON.parse(item.attributes || '{}');\n        tags = Object.values(attributesObj);\n      } catch (err) {\n        console.error('解析 attributes 失败:', err);\n        tags = [];\n      }\n      return {\n        id: item.id,\n        imgUrl: sanitizeImageUrl(item.mainImageUrl, 'demand'),\n        tags: ['需求'],\n        title: item.title || '未知需求',\n        desc: item.description || '',\n        categoryName: '需求分类', \n        user: {\n          avatar: sanitizeImageUrl(item?.requester?.avatar, 'avatar'),\n          nickname: item?.requester?.nickname || '未知用户'\n        },\n        category: '全部',\n        type: 'demand',\n        price: item.budget || 0,\n        status: item.status,\n        sortPriority: item.adminPinScore || 0,\n        isAdminPinned: item.isAdminPinned || false\n      };\n    })\n  );\n  console.log('清洗后的需求数据：', tempDemandList);\n  // 筛选需求数据\n  const activeDemandList = tempDemandList.filter(item => item.status === 'active');\n  // 更严谨的方式是用两个响应式变量分别存储清洗后的商品和需求数据\n  demandRecommendations.value = activeDemandList;\n};\n\n//清洗函数（商品）\nconst cleanGoodsList = async () => {\n  console.log('清洗前的商品数据：', uglyGoodsList.value);\n  const tempGoodsList = await Promise.all(\n    uglyGoodsList.value.map(async (item) => {\n      let tags = [];\n      try {\n        const attributesObj = JSON.parse(item.attributes || '{}');\n        tags = Object.values(attributesObj);\n        tags.unshift(item.isNegotiable ? '可刀' : '不可刀');\n      } catch (err) {\n        console.error('解析 attributes 失败:', err);\n        tags = [];\n      }\n      return {\n        id: item.id,\n        imgUrl: sanitizeImageUrl(item.mainImageUrl, 'product'),\n        tags,\n        title: item.title || '未知商品',\n        desc: item.description || '',\n        categoryName: item.categoryName,\n        user:{\n          avatar: sanitizeImageUrl(item?.sellerAvatarUrl, 'avatar'),\n          nickname: item?.sellerNickname || '未知用户'\n        },\n        category: tags[1] || '其他', \n        type: 'product',\n        price: item.price || 0,\n        status: item.status,\n        sortPriority: item.adminPinScore || 0,\n        isAdminPinned: item.isAdminPinned || false\n      };\n    })\n  );\n  // 筛选 active 状态的数据\n  const activeGoodsList = tempGoodsList.filter(item => item.status === 'active');\n  console.log('清洗并筛选后的商品数据：', activeGoodsList);\n  goodsRecommendations.value = activeGoodsList;\n};\n\n// 查询当前商品/需求的收藏状态\nconst fetchFavoriteStatus = async () => {\n  try {\n    const res = await userApi.getFavoriteStatus(detailType,detailId)\n    isCollected.value = res.data;\n\tif(res.code === 200){\n\t\tconsole.log('查询用户的收藏状态为：',isCollected.value)\n\t}\n  } catch (error) {\n    console.error('查询收藏状态失败:', error);\n  }\n};\n\n// 切换收藏状态（收藏/取消收藏）\nconst toggleCollect = async () => {\n  // 未登录则弹窗提示并阻止收藏操作\n  if (!ensureLoggedIn({ content: '登录后才能收藏商品/需求', redirectTo: '/pages/mine/mine' })) return;\n  try {\n    if (isCollected.value) {\n      // 取消收藏\n      const res = await userApi.cancelFavorite({\n\t\t itemId:detailId, \n\t\t itemType:detailType\n\t  })\n\t  if(res.code === 200){\n\t\tuni.showToast({ title: '取消收藏成功', icon: 'success' }); \n\t\tisCollected.value = !isCollected.value;\n\t  }\n    } else {      \n      const res = await userApi.addFavorite({\n\t\t itemId:detailId, \n\t\t itemType:detailType\n\t  });\n\t  if(res.code === 200){\n\t  \tuni.showToast({ title: '收藏成功', icon: 'success' }); \n\t    isCollected.value = !isCollected.value;\n\t  }\n    }\n\tconsole.log('操作后的收藏状态为：',isCollected.value)\n  } catch (error) {\n    console.error('收藏操作失败:', error);\n    uni.showToast({ \n      title: isCollected.value ? '取消收藏失败' : '收藏失败', \n      icon: 'none' \n    });\n    // 恢复状态（接口失败时不改变UI）\n    isCollected.value = !isCollected.value;\n  }\n};\n\n// 提交举报\nconst submitReport = async () => {\n  if (!reportReason.value.trim()) {\n    uni.showToast({ title: '请输入举报原因', icon: 'none' });\n    return;\n  }\n\n  try {\n    // 登录校验：未登录直接提示并拦截\n    if (!ensureLoggedIn({ content: '登录后才能提交举报', redirectTo: '/pages/mine/mine' })) return;\n\n    // 构造举报参数（根据类型传递对应的ID）\n    const reportParams = {\n      reason: reportReason.value,\n      reportedProductId: detailType === 'product' ? detailId : undefined,\n      reportedDemandId: detailType === 'demand' ? detailId : undefined,\n      // 举报用户ID：商品举报指向卖家，需求举报指向发布者\n      reportedUserId: detailType === 'product'\n        ? (detail.value?.sellerId || undefined)\n        : (detail.value?.requester?.id || undefined)\n    };\n\n    // 去除 undefined/null 字段，避免后端接收无效键\n    const cleanedParams = Object.fromEntries(\n      Object.entries(reportParams).filter(([_, v]) => v !== undefined && v !== null)\n    );\n\n    const res = await userApi.submitReport(cleanedParams);\n    if (res.code === 200 || res.code === 201) {\n      uni.showToast({ title: res.data, icon: 'success' });\n      showReportDialog.value = false;\n    } else {\n      // 优先展示后端的具体原因\n      uni.showToast({ title: res.msg || '举报提交失败', icon: 'none' });\n    }\n  } catch (error) {\n    console.error('举报接口调用失败:', error);\n    uni.showToast({ title: '网络错误，请重试', icon: 'none' });\n  }\n};\n\n// 监听页面滚动到底部\nonReachBottom(() => {\n  hasReachedBottom.value = true;\n  // 5秒后自动隐藏底部提示\n  setTimeout(() => {\n    hasReachedBottom.value = false;\n  }, 5000);\n});\n\n// 计算所有商品图片（主图 + 详情图）\nconst allProductImages = computed(() => {\n  if (!detail.value) return [];\n  const images = [];\n  if (detail.value.imgUrl) {\n    images.push(detail.value.imgUrl);\n  }\n  if (detail.value.detailImages && Array.isArray(detail.value.detailImages) && detail.value.detailImages.length) {\n    images.push(...detail.value.detailImages);\n  }\n  const type = detailType === 'demand' ? 'demand' : 'product';\n  if (images.length === 0) {\n    return [sanitizeImageUrl('', type)];\n  }\n  return images.map(u => sanitizeImageUrl(u, type));\n});\n\n// 格式化时间\nconst formatTime = (timeStamp) => {\n  if (!timeStamp) return '';\n  \n  const now = Date.now();\n  const diff = now - timeStamp;\n  const dayMs = 86400000; // 一天的毫秒数\n  \n  if (diff < dayMs) {\n    // 小于一天，显示小时前\n    const hours = Math.floor(diff / 3600000);\n    return hours > 0 ? `${hours}小时前` : '刚刚';\n  } else if (diff < dayMs * 2) {\n    return '1天前';\n  } else if (diff < dayMs * 3) {\n    return '2天前';\n  } else {\n    // 超过3天，显示具体日期\n    const date = new Date(timeStamp);\n    return `${date.getMonth() + 1}月${date.getDate()}日`;\n  }\n};\n\n// 预览图片\nconst previewImages = (index) => {\n  if (allProductImages.value.length === 0) return;\n  uni.previewImage({\n    current: index,\n    urls: allProductImages.value,\n  });\n};\n\n// 点击聊一聊跳转到聊天界面\nconst goToChat = () => {\n  // 登录、学生认证、会员等级拦截\n  if (!ensureLoggedIn({ content: '登录后才能聊一聊', redirectTo: '/pages/mine/mine' })) return;\n  if (!ensureStudentCertified({ content: '请先完成学生认证后再进行聊天' })) return;\n  if (!ensureMembership('normal', { content: '聊天功能仅对普通会员及以上开放' })) return;\n  // 1. 提取聊天对象ID（区分商品/需求类型）\n  let sellerId = '';\n  if (detailType === 'product') {\n    // 商品类型：聊天对象是卖家，ID从 detail.sellerId 获取\n    sellerId = detail.value.sellerId || '';\n  } else if (detailType === 'demand') {\n    // 需求类型：聊天对象是需求发布者，ID从 detail.requester.id 获取\n    sellerId = detail.value.requester?.id || '';\n  }\n\n  // 2. 提取当前商品/需求ID和类型（用于聊天页显示关联信息）\n  const itemId = detailId; // detailId 是 onLoad 中接收的当前商品/需求ID\n  const itemType = detailType; // 商品/需求类型（product/demand）\n\n  // 3. 校验必要参数，避免跳转异常\n  if (!sellerId || !itemId) {\n    uni.showToast({ title: '无法获取聊天对象信息', icon: 'none' });\n    return;\n  }\n\n  // 4. 跳转到聊天页，携带参数（与聊天页 onLoad 接收的参数键名保持一致）\n  uni.navigateTo({\n    url: `/pages/chat/chat?sellerId=${sellerId}&itemId=${itemId}&type=${itemType}`\n  });\n};\n\n// 点击商品跳转到详情页\nconst goToDetail = (id, type) => {\n  const targetType = type || detailType || 'product';\n  uni.navigateTo({\n    url: `/pages/ProductDetail/ProductDetail?id=${id}&type=${targetType}`,\n  });\n};\n\n</script>\n\n<style scoped>\n/* 基础样式 */\n.product-detail-page {\n  background-color: #f5f5f5;\n  min-height: 100vh;\n  font-size: 28rpx;\n}\n\n/* 卖家信息 */\n.seller-info-container {\n  display: flex;\n  align-items: center;\n  padding: 16rpx 20rpx;\n  background-color: #fff;\n}\n\n.seller-avatar {\n  width: 60rpx;\n  height: 60rpx;\n  border-radius: 50%;\n  margin-right: 16rpx;\n}\n\n.seller-name {\n  font-size: 28rpx;\n  font-weight: 500;\n  flex-shrink: 0;\n}\n\n.credit-tag {\n  background-color: #ffe100;\n  color: #333;\n  font-size: 22rpx;\n  padding: 2rpx 10rpx;\n  border-radius: 4rpx;\n  margin-left: 10rpx;\n  flex-shrink: 0;\n}\n\n/* 商品主图 */\n.product-main-image {\n  position: relative;\n  background-color: #fff;\n}\n\n.main-image {\n  width: 100%;\n  height: auto;\n}\n\n.image-count {\n  position: absolute;\n  right: 20rpx;\n  bottom: 20rpx;\n  background-color: rgba(0, 0, 0, 0.5);\n  color: #fff;\n  font-size: 24rpx;\n  padding: 4rpx 10rpx;\n  border-radius: 14rpx;\n}\n\n/* 商品信息 */\n.product-info {\n  background-color: #fff;\n  padding: 20rpx 30rpx;\n  border-bottom: 1px solid #eee;\n}\n\n.price-container {\n  margin-bottom: 20rpx;\n  display: flex;\n  align-items: baseline;\n}\n\n.price-symbol {\n  color: #ff4d4f;\n  font-size: 30rpx;\n}\n\n.price {\n  color: #ff4d4f;\n  font-size: 40rpx;\n  font-weight: bold;\n  margin-right: 20rpx;\n}\n\n.original-price {\n  color: #999;\n  font-size: 26rpx;\n  text-decoration: line-through;\n}\n\n.discount-tag {\n  background-color: #ffe6e6; /* 浅红色背景，可根据喜好调整 */\n  border-radius: 5px;\n  color: #ff0000;\n  padding: 8px 15px;\n  font-size: 14px;\n  display: block;\n  margin-bottom: 15rpx;\n}\n\n.bold-text {\n  margin-right: 15rpx;\n  font-weight: bold;\n}\n.product-title {\n  font-size: 34rpx;\n  line-height: 1.5;\n  margin-bottom: 20rpx;\n  display: block;\n  word-break: break-all;\n}\n\n.product-stats-container {\n  display: flex;\n  align-items: center;\n  color: #999;\n  font-size: 26rpx;\n}\n\n.stats-item {\n  margin: 0 6rpx;\n}\n\n.divider {\n  color: #ddd;\n  margin: 0 6rpx;\n}\n\n.location {\n  color: #999;\n  font-size: 26rpx;\n}\n\n.location-sales {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n/* 通用区块样式 */\n.section-title {\n  font-size: 32rpx;\n  font-weight: bold;\n  padding: 25rpx 30rpx;\n  background-color: #fff;\n  border-bottom: 1px solid #eee;\n  position: relative;\n  display: flex; /* 开启弹性布局，方便文字与伪元素对齐 */\n  align-items: center; /* 垂直居中对齐 */\n}\n\n.section-title::after {\n  content: '';\n  position: absolute;\n  left: 20rpx; \n  width: 6rpx;\n  height: 32rpx;\n  background-color: #ff4d4f;\n  border-radius: 3rpx;\n  margin-right: 15rpx;\n}\n\n/* 商品详情 */\n.product-detail-section {\n  margin-top: 20rpx;\n  background-color: #fff;\n}\n\n.detail-content {\n  padding: 20rpx;\n}\n\n.product-desc {\n  line-height: 1.6;\n  margin-bottom: 30rpx;\n  display: block;\n  font-size: 28rpx;\n  color: #333;\n}\n\n.detail-images {\n  width: 100%;\n}\n\n.detail-image {\n  width: 100%;\n  margin-bottom: 15rpx;\n  border-radius: 10rpx;\n}\n\n/* 商家信息 */\n.seller-section {\n  margin-top: 20rpx;\n  background-color: #fff;\n}\n\n.seller-info {\n  display: flex;\n  align-items: center;\n  padding: 25rpx 20rpx;\n  border-bottom: 1px solid #eee;\n}\n\n.seller-avatar-large {\n  width: 100rpx;\n  height: 100rpx;\n  border-radius: 50%;\n  margin-right: 20rpx;\n}\n\n.seller-details {\n  display: flex;\n  gap: 25rpx;\n  flex: 1;\n}\n\n.seller-goods-count {\n  color: #999;\n  font-size: 26rpx;\n}\n\n/* 聊一聊按钮：调整尺寸和样式 */\n.contact-seller {\n  width: 140rpx;\n  height: 60rpx;\n  line-height: 60rpx;\n  text-align: center;\n  border: 1px solid #ff4d4f;\n  color: #ff4d4f;\n  border-radius: 30rpx;\n  font-size: 26rpx;\n  background-color: transparent;\n  margin-right: 0; /* 取消原有右边距 */\n}\n\n.seller-goods-title {\n  font-size: 28rpx;\n  padding: 20rpx;\n  border-bottom: 1px solid #f5f5f5;\n  color: #666;\n}\n\n/* 商品滚动区域样式 */\n.goods-scroll-container {\n  width: 100%;\n  padding: 16rpx;\n  box-sizing: border-box;\n}\n\n.goods-scroll {\n  width: 100%;\n  white-space: nowrap;\n}\n\n.goods-list {\n  display: inline-flex;\n  gap: 20rpx;\n}\n\n.goods-item {\n  width: 200rpx;\n  display: inline-block;\n  text-align: center;\n  position: relative;\n}\n\n.goods-image {\n  width: 200rpx;\n  height: 200rpx;\n  border-radius: 10rpx;\n  object-fit: cover;\n}\n\n.goods-price {\n  position: absolute;\n  bottom: 5rpx;\n  left: 5rpx;\n  background-color: rgba(0, 0, 0, 0.5);\n  color: #fff;\n  font-size: 24rpx;\n  padding: 2rpx 10rpx;\n  border-radius: 6rpx;\n}\n\n.no-more-seller-goods {\n  width: 100%;\n  text-align: center;\n  padding: 60rpx 0;\n  color: #999;\n  font-size: 28rpx;\n}\n\n/* 推荐商品 */\n.recommendation-section {\n  margin-top: 20rpx;\n  background-color: #fff;\n  margin-bottom: 120rpx; /* 留出底部操作栏空间 */\n}\n\n/* 底部操作栏整体 */\n.bottom-bar {\n  display: flex;\n  align-items: center;\n  justify-content: space-around; /* 均匀分布按钮 */\n  gap: 80rpx;\n  background-color: #fff;\n  border-top-left-radius: 20rpx; /* 顶部圆角 */\n  border-top-right-radius: 20rpx;\n  padding: 15rpx; \n  padding-bottom: 40rpx;\n  box-shadow: 0 -2rpx 10rpx rgba(0, 0, 0, 0.1); /* 底部阴影，增强层次感 */\n  position: fixed;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  z-index: 999;\n}\n\n/* 收藏文字 */\n.collect-text {\n  font-size: 24rpx;\n  margin-top: 6rpx;\n  color: #666;\n}\n\n.collect-btn-container {\n  display: flex;\n  flex-direction: column; \n  align-items: center;\n}\n\n/* 收藏按钮 */\n.favBtn{\n\tmargin-left: 16rpx;\n}\n\n/* 通用按钮样式 */\n.bar-button {\n  display: flex;\n  flex-direction: column; \n  align-items: center;\n  justify-content: center;\n  background-color: transparent;\n  padding: 10rpx;\n  font-size: 24rpx;\n}\n\n/* 聊天按钮容器 */\n.chat-btn {\n  position: relative;\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  height: 75rpx;\n  align-items: center;\n  background-color: #ffe100; \n  color: #333;\n  border-radius: 60rpx; \n  margin: 15rpx 10rpx;\n  padding: 0 20rpx;\n  font-size: 28rpx;\n  font-weight: 500;\n  border: none;\n  outline: none;\n  box-shadow: 0 4rpx 8rpx rgba(44, 140, 255, 0.3); /* 轻微阴影增强立体感 */\n  transition: all 0.2s ease;\n}\n\n/* 按钮点击效果 */\n.chat-btn:active {\n  background-color: #e8b61e;\n  transform: scale(0.98); /* 点击时轻微缩小 */\n}\n\n/* 图标容器 */\n.icon-chat {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-bottom: 8rpx;\n  width: 44rpx;\n  height: 44rpx;\n}\n\n/* 聊天图标 */\n.chat-icon {\n  width: 100%;\n  height: 100%;\n  object-fit: contain; \n  filter: brightness(0) invert(1); \n}\n\n/* 文字样式 */\n.chat-btn text {\n  letter-spacing: 0.5rpx;\n}\n\n/* 滚动到底提醒样式 */\n.bottom-reminder {\n  text-align: center;\n  padding: 20rpx;\n  color: #666;\n  font-size: 26rpx;\n  background-color: #f0f0f0;\n  margin: 16rpx;\n  border-radius: 8rpx;\n  animation: fadeIn 0.5s;\n}\n\n.statusBar {\n  width: 100%;\n  z-index: 99;\n  height: 62.4rpx;\n}\n\n/* 举报按钮：调整尺寸和样式 */\n.report-btn {\n  width: 140rpx;\n  height: 60rpx;\n  line-height: 60rpx;\n  text-align: center;\n  border: 1px solid #ff4d4f;\n  color: #ff4d4f;\n  border-radius: 30rpx;\n  font-size: 26rpx;\n  background-color: transparent;\n}\n\n/* 举报弹窗样式 */\n.report-dialog {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  z-index: 9999;\n}\n\n.dialog-mask {\n  width: 100%;\n  height: 100%;\n  background-color: rgba(0, 0, 0, 0.5);\n}\n\n.dialog-content {\n  position: absolute;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  background-color: #fff;\n  border-top-left-radius: 20rpx;\n  border-top-right-radius: 20rpx;\n  padding: 30rpx;\n  box-sizing: border-box;\n}\n\n.dialog-title {\n  font-size: 32rpx;\n  font-weight: bold;\n  margin-bottom: 20rpx;\n  padding-bottom: 20rpx;\n  border-bottom: 1px solid #eee;\n}\n\n.dialog-form {\n  margin-bottom: 30rpx;\n}\n\n.form-label {\n  display: block;\n  font-size: 28rpx;\n  margin-bottom: 10rpx;\n  color: #333;\n}\n\n.form-input {\n  width: 100%;\n  min-height: 120rpx;\n  border: 1px solid #ddd;\n  border-radius: 8rpx;\n  padding: 15rpx;\n  box-sizing: border-box;\n  font-size: 28rpx;\n}\n\n.dialog-footer {\n  display: flex;\n  gap: 20rpx;\n  margin-bottom: 30rpx;\n}\n\n.cancel-btn, .confirm-btn {\n  flex: 1;\n  height: 80rpx;\n  line-height: 80rpx;\n  border-radius: 40rpx;\n  font-size: 30rpx;\n}\n\n.cancel-btn {\n  border: 1px solid #999;\n  color: #999;\n  background-color: transparent;\n}\n\n.confirm-btn {\n  background-color: #ff4d4f;\n  color: #fff;\n  border: none;\n}\n\n.action-buttons {\n  display: flex;\n  gap: 16rpx; /* 按钮之间的间距 */\n}\n\n.name{\n\tmargin-right: 20rpx;\n}\n</style>\n","import MiniProgramPage from 'C:/Users/86133/Desktop/demo/Lezhuan/pages/ProductDetail/ProductDetail.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","onLoad","onMounted","uni","userApi","detailId","productApi","type","sanitizeImageUrl","ensureLoggedIn","onReachBottom","computed","ensureStudentCertified","ensureMembership"],"mappings":"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"}