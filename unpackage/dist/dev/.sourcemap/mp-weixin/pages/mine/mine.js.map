{"version":3,"file":"mine.js","sources":["pages/mine/mine.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbWluZS9taW5lLnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"user-page\">\n    <!-- 带有光斑效果的头部区域 -->\n    <view class=\"header-container\">\n      <!-- 顶部留白区域 -->\n      <view class=\"top-space\"></view>\n      <!-- 顶部用户信息区域 -->\n      <view class=\"user-info\">\n        <view class=\"avatar\" @click=\"handleLogin\">\n          <image\n            :src=\"userInfo?.avatarUrl \"\n            mode=\"aspectFill\"\n          ></image>\n        </view>\n        <view class=\"nickname-id\">\n          <text class=\"nickname\">{{ userInfo?.nickname || '点击头像登录' }}</text>\n          <text class=\"id\">\n            用户ID: {{ studentIdNumber || '请完成学生认证' }}\n          </text>\n        </view>\n        <view class=\"setting-btn\" @click=\"handleSetting\">\n          <uni-icons type=\"gear\" size=\"30\"></uni-icons>\n        </view>\n      </view>\n\n      <!-- 权益/轮播图区域 -->\n      <view class=\"benefit-banner\">\n        <template v-if=\"studentAuthenticated\">\n          <swiper class=\"banner-swiper\" autoplay interval=\"3000\" circular>\n            <swiper-item v-for=\"(item, index) in bannerList\" :key=\"index\">\n              <image :src=\"item.imageUrl\" mode=\"widthFix\" class=\"banner-img\" @click=\"handleBannerClick(item)\"></image>\n            </swiper-item>\n          </swiper>\n        </template>\n        <template v-else>\n          <view class=\"auth-card\" @click=\"handleAuth\">\n            <view class=\"auth-content\">\n              <text class=\"auth-text\">完成学生认证可解锁更多功能，上传学生证、饭卡或学信网证明均可</text>\n              <button class=\"auth-button\">立即认证</button>\n            </view>\n          </view>\n        </template>\n      </view>\n    </view>\n\n    <!-- 功能按钮区域 -->\n\t<view class=\"function-buttons\">\n\t  <view class=\"button-group\">\n\t\t<!-- 我发布的 -->\n\t\t<button class=\"function-btn\" @click=\"handlePublish\">\n\t\t  <view class=\"icon-wrapper publish\">\n\t\t\t<image src=\"https://api.shaolezhuan.cn/lzphoto/mine-icons/publish-icon.png\" mode=\"aspectFit\" class=\"btn-icon\"></image>\n\t\t  </view>\n\t\t  <text>我发布的</text>\n\t\t</button>\n\t\t<!-- 我卖出的 -->\n\t\t<button class=\"function-btn\" @click=\"handleSell\">\n\t\t  <view class=\"icon-wrapper sell\">\n\t\t\t<image src=\"https://api.shaolezhuan.cn/lzphoto/mine-icons/sell-icon.png\" mode=\"aspectFit\" class=\"btn-icon\"></image>\n\t\t  </view>\n\t\t  <text>我卖出的</text>\n\t\t</button>\n\t\t<!-- 消息 -->\n\t\t<button class=\"function-btn\" @click=\"handleMessage\">\n\t\t  <view class=\"icon-wrapper message\">\n\t\t    <image src=\"https://api.shaolezhuan.cn/lzphoto/mine-icons/message-icon.png\" mode=\"aspectFit\" class=\"btn-icon\"></image>\n\t\t    <!-- 未读消息徽章 -->\n\t\t    <view class=\"unread-badge\" v-if=\"unreadCount > 0\">\n\t\t      <text class=\"badge-text\">{{ unreadCount }}</text>\n\t\t    </view>\n\t\t  </view>\n\t\t  <text>消息</text>\n\t\t</button>\t\t\t\t\n\t\t<!-- 历史浏览 -->\n\t\t<button class=\"function-btn\" @click=\"handleHistory\">\n\t\t  <view class=\"icon-wrapper history\">\n\t\t\t<image src=\"https://api.shaolezhuan.cn/lzphoto/mine-icons/history-icon.png\" mode=\"aspectFit\" class=\"btn-icon\"></image>\n\t\t  </view>\n\t\t  <text>历史浏览</text>\n\t\t</button>\n\t  </view>\n\t  <view class=\"button-group\">\n\t\t<!-- 我的需求 -->\n\t\t<button class=\"function-btn\" @click=\"handleDemand\">\n\t\t  <view class=\"icon-wrapper demand\">\n\t\t\t<image src=\"https://api.shaolezhuan.cn/lzphoto/mine-icons/demand-icon.png\" mode=\"aspectFit\" class=\"btn-icon\"></image>\n\t\t  </view>\n\t\t  <text>我的需求</text>\n\t\t</button>\n\t\t<!-- 收藏 -->\n\t\t<button class=\"function-btn\" @click=\"handleCollect\">\n\t\t  <view class=\"icon-wrapper collect\">\n\t\t\t<image src=\"https://api.shaolezhuan.cn/lzphoto/mine-icons/collect-icon.png\" mode=\"aspectFit\" class=\"btn-icon\"></image>\n\t\t  </view>\n\t\t  <text>收藏</text>\n\t\t</button>\n\t\t<!-- 用户指南 -->\n\t\t<button class=\"function-btn\" @click=\"handleGuide\">\n\t\t  <view class=\"icon-wrapper guide\">\n\t\t\t<image src=\"https://api.shaolezhuan.cn/lzphoto/mine-icons/guide-icon.png\" mode=\"aspectFit\" class=\"btn-icon\"></image>\n\t\t  </view>\n\t\t  <text>用户指南</text>\n\t\t</button>\n\t\t<!-- 其他 -->\n\t\t<button class=\"function-btn\" @click=\"handleWant\">\n\t\t  <view class=\"icon-wrapper want\">\n\t\t\t<image src=\"https://api.shaolezhuan.cn/lzphoto//mine-icons/want-icon.png\" mode=\"aspectFit\" class=\"btn-icon\"></image>\n\t\t  </view>\n\t\t  <text>...</text>\n\t\t</button>\n\t  </view>\n\t</view>\n\n   <!-- 客服按钮容器 -->\n   <view class=\"contact-btn-container\">\n     <!-- 原微信客服按钮：使用小程序原生事件写法 -->\n     <button \n       open-type=\"contact\" \n       @contact=\"handleContact\" \n       session-from=\"sessionFrom\"\n       class=\"original-contact-btn\"\n     >\n       联系客服\n     </button>\n   \n     <!-- 自定义客服按钮：点击触发自定义逻辑 -->\n     <button \n       class=\"contact-service-btn\" \n       @click=\"handleContactService\"\n     >\n       联系客服\n     </button>\n   </view>\n    \n\t<!-- 重新登录提示（当code无效时显示） -->\n    <view v-if=\"needRelogin\" class=\"relogin-tip\">\n      <button @click=\"handleRelogin\">重新登录</button>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, onMounted, computed ,onUnmounted} from 'vue';\nimport { onShow } from '@dcloudio/uni-app';\nimport userApi from '@/api/user.js';\nimport chatApi from '@/api/chat.js';\nimport { useStorage } from '@/hooks/useStorage'; // 自定义存储hook\nimport { ensureLoggedIn } from '@/utils/uniHelper';\n\n// 存储相关\nconst { getStorage, setStorage } = useStorage();\nconst userId = computed(() => getStorage('userId'));\nconst token = computed(() => getStorage('token'));\n\n// 响应式数据\nconst userInfo = ref(null);\nconst studentInfo = ref(null);\nconst studentAuthenticated = ref(false);//学生认证是否认证通过\nconst studentStatus = ref(null);//学生认证状态（pending_review-待审核, approved-已通过, rejected-已拒绝, not_verified-未申请认证）\nconst needRelogin = ref(false);\nconst studentIdNumber = ref(null);\n\n// 头像与昵称回退相关：当基础库统一返回默认头像/昵称时，为用户分配更好看的随机头像与随机昵称\nconst DEFAULT_AVATAR_URL = 'https://api.shaolezhuan.cn/lzphoto/avatars/avatar3.jpg';\nconst RANDOM_AVATARS = [\n  'https://api.shaolezhuan.cn/lzphoto/avatars/avatar3.jpg',\n  'https://api.shaolezhuan.cn/lzphoto/avatars/avatar4.jpg',\n  'https://api.shaolezhuan.cn/lzphoto/avatars/avatar5.jpg',\n  'https://api.shaolezhuan.cn/lzphoto/avatars/avatar6.jpg',\n  'https://api.shaolezhuan.cn/lzphoto/avatars/avatar7.jpg',\n  'https://api.shaolezhuan.cn/lzphoto/avatars/avatar8.jpg',\n  'https://api.shaolezhuan.cn/lzphoto/avatars/avatar9.jpg',\n  'https://api.shaolezhuan.cn/lzphoto/avatars/avatar10.jpg',\n  'https://api.shaolezhuan.cn/lzphoto/avatars/avatar11.jpg',\n  'https://api.shaolezhuan.cn/lzphoto/avatars/avatar12.jpg',\n];\nconst pickRandomAvatar = () => {\n  const idx = Math.floor(Math.random() * RANDOM_AVATARS.length);\n  return RANDOM_AVATARS[idx] || DEFAULT_AVATAR_URL;\n};\nconst isDefaultNickname = (name) => {\n  if (!name) return true;\n  const normalized = String(name).trim();\n  return (\n    normalized === '微信用户' ||\n    normalized === '用户' ||\n    normalized === '未知用户' ||\n    normalized === '点击头像登录'\n  );\n};\nconst isInvalidAvatar = (url) => {\n  if (!url) return true;\n  const u = String(url).trim();\n  // 基础库可能返回统一头像或空值，统一按无效处理\n  return u === '' || /default|placeholder/i.test(u);\n};\nconst generateRandomNickname = () => {\n  // 简洁好看的随机昵称：乐赚用户 + 4位数字\n  const suffix = Math.floor(1000 + Math.random() * 9000);\n  return `乐转用户${suffix}`;\n};\nconst bannerList = ref([\n  { imageUrl: 'https://api.shaolezhuan.cn/lzphoto/membership/m1.jpg' },\n  { imageUrl: 'https://api.shaolezhuan.cn/lzphoto/membership/m2.jpg' },\n  { imageUrl: 'https://api.shaolezhuan.cn/lzphoto/membership/m3.jpg' },\n  { imageUrl: 'https://api.shaolezhuan.cn/lzphoto/membership/m4.jpg', link: '/pages/promo/promo' }\n]);\n\nconst unreadCount = ref(0); // 未读消息总数\n// 定时器实例（用于页面卸载时清除）\nconst unreadTimer = ref(null);\n// 页面显示时触发（包括从其他页面返回）：刷新用户信息与未读消息\nonShow(() => {\n  if (token.value && userId.value) {\n    fetchUserInfo();\n    fetchStudentInfo();\n    fetchUnreadMessages();\n    // 保证定时器仅启动一次\n    if (!unreadTimer.value) startUnreadTimer();\n  }\n});\n\n// 页面挂载时初始化\nonMounted(() => {\n  if (token.value && userId.value) {\n    fetchUserInfo();\n\tfetchStudentInfo();\n\tfetchUnreadMessages(); \n\t// 启动3秒刷新定时器\n\tstartUnreadTimer();\n  }\n});\n\n// 启动定时器：每3秒调用一次fetchUnreadMessages\nconst startUnreadTimer = () => {\n  unreadTimer.value = setInterval(() => {\n    fetchUnreadMessages();\n  }, 3000); // 3000毫秒 = 3秒\n};\n\n// 调用“获取用户所有未读消息”接口\nconst fetchUnreadMessages = async () => {\n  try {\n    const userId = getStorage('userId');\n    if (!userId) return; // 未登录则跳过\n\n    const res = await chatApi.unreadMessages(userId);\n\tconsole.log('获取用户所有未读消息返回信息:',res)\n\n    if (res.code === 200) {\n      unreadCount.value = res.data.totalUnreadCount || 0;\n    }\n  } catch (err) {\n    console.error('获取未读消息失败:', err);\n  }\n};\n\n\n// 获取用户信息（当服务端返回默认头像/昵称时，优先使用本地缓存或默认头像做展示）\nconst fetchUserInfo = async () => {\n  try {\n    const res = await userApi.getCurrentUser();\n    if (res.code === 200) {\n      const serverData = res.data || {};\n      const cachedNickname = uni.getStorageSync('nickname');\n      const cachedAvatar = uni.getStorageSync('avatarUrl');\n      const serverAvatar = serverData.avatarUrl;\n      const finalAvatarUrl = isInvalidAvatar(serverAvatar)\n        ? (cachedAvatar || DEFAULT_AVATAR_URL)\n        : serverAvatar;\n      // 统一规范 membershipType：将后端可能返回的中文/大小写/数字统一映射\n      const normalizeMembershipType = (raw) => {\n        const val = String(raw ?? '').trim();\n        const lower = val.toLowerCase();\n        if (!val) return 'none';\n        // 中文与常见别名映射\n        if (/白金/.test(val) || lower.includes('platinum') || val === '2' || lower.includes('vip_platinum') || lower.includes('platinum_member')) {\n          return 'platinum';\n        }\n        if (/普通/.test(val) || lower === 'normal' || val === '1' || lower.includes('vip') || lower.includes('member')) {\n          return 'normal';\n        }\n        // 已是标准值或其它未知\n        return lower === 'platinum' || lower === 'normal' ? lower : 'none';\n      };\n\n      userInfo.value = {\n        ...serverData,\n        nickname: isDefaultNickname(serverData.nickname)\n          ? (cachedNickname || serverData.nickname)\n          : serverData.nickname,\n        avatarUrl: finalAvatarUrl,\n      };\n\t  uni.setStorageSync('membershipType', normalizeMembershipType(userInfo.value.membershipType));\n      console.log('获取当前用户信息：', userInfo.value);\n\t}\n  } catch (err) {\n    console.error('获取用户信息失败:', err);\n  }\n};\n\n// 获取用户学生认证状态信息\nconst fetchStudentInfo = async () => {\n  try {\n    const res = await userApi.studentInfoStatus();\n    if (res.code === 200) {\n      studentInfo.value = res.data;\n      studentStatus.value = res.data.status;\n\t  \n\t  // console.log('认证状态：',studentStatus.value)\n      console.log('获取当前用户学生认证状态：',studentInfo.value)\n\t  if (studentStatus.value === 'approved' ){\n\t\tstudentAuthenticated.value = true;\n\t\tstudentIdNumber.value = studentInfo.value.studentIdNumber\n\t\t//储存学号方便设置那里调用\n\t\tsetStorage('studentIdNumber', studentIdNumber.value)\n\t\tconsole.log(studentIdNumber.value)\n\t  }\n\t}\n  } catch (err) {\n    console.error('获取学生认证失败:', err);\n  }\n};\n\n// 处理登录流程\nconst handleLogin = async () => {\n  // 已登录则给出提示弹窗并不再发起登录流程\n  if (token.value && userId.value) {\n    uni.showModal({ title: '提示', content: '您已登录，无需重复登录', showCancel: false });\n    return;\n  }\n  try {\n    // 获取用户头像和昵称\n    const userProfileRes = await new Promise((resolve, reject) => {\n      uni.getUserProfile({\n        desc: '用于完善用户资料',\n        success: resolve,\n        fail: reject\n      });\n    });\n \n    // 获取登录凭证code\n    const loginRes = await new Promise((resolve, reject) => {\n      uni.login({\n        success: resolve,\n        fail: reject\n      });\n    });\n\n    if (!loginRes.code) {\n      throw new Error('无法获取登录凭证');\n    }\n\n    // 读取本地已分配的昵称（头像在每次登录时随机分配）\n    const storedNickname = uni.getStorageSync('nickname');\n\n    // 计算用于提交给后端的头像与昵称（在基础库返回默认值时回退到更好看的固定头像与随机昵称）\n    const nicknameCandidate = storedNickname || (\n      isDefaultNickname(userProfileRes?.userInfo?.nickName)\n        ? generateRandomNickname()\n        : userProfileRes?.userInfo?.nickName\n    );\n    // 登录时为用户随机分配一个头像（参考提供的图片路径）\n    const avatarCandidate = pickRandomAvatar();\n\n    // 调用登录API\n    const loginData = {\n      code: loginRes.code,\n      nickname: nicknameCandidate,\n      avatarUrl: avatarCandidate,\n    };\n\t\n\tconsole.log('code：',loginData.code)\n\tconsole.log('nickname（提交后端）：',loginData.nickname)\n\tconsole.log('avatarUrl（提交后端）：',loginData.avatarUrl)\n    \n    const res = await userApi.wxLogin(loginData);     \n\t \n    if (res.code === 200) {\n      const userData = res.data;\n      // 存储用户信息：若服务端仍返回默认值，则沿用我们提交的回退值，保证展示与存储一致\n      const finalNickname = isDefaultNickname(userData?.nickname)\n        ? loginData.nickname\n        : userData.nickname;\n      // 优先使用服务端返回的头像；如无效则使用本次随机分配的头像\n      const finalAvatarUrl = !isInvalidAvatar(userData?.avatarUrl)\n        ? userData.avatarUrl\n        : loginData.avatarUrl;\n\n      setStorage('token', userData.token);\n      setStorage('nickname', finalNickname);\n      setStorage('avatarUrl', finalAvatarUrl);\n\t  setStorage('userId', userData.userId);\n\t  setStorage('openid', userData.openid);\n\t  // 规范化 membershipType 后再写入本地\n\t  const normalizeMembershipType = (raw) => {\n\t\tconst val = String(raw ?? '').trim();\n\t\tconst lower = val.toLowerCase();\n\t\tif (!val) return 'none';\n\t\tif (/白金/.test(val) || lower.includes('platinum') || val === '2' || lower.includes('vip_platinum') || lower.includes('platinum_member')) {\n\t\t  return 'platinum';\n\t\t}\n\t\tif (/普通/.test(val) || lower === 'normal' || val === '1' || lower.includes('vip') || lower.includes('member')) {\n\t\t  return 'normal';\n\t\t}\n\t\treturn lower === 'platinum' || lower === 'normal' ? lower : 'none';\n\t  };\n\t  uni.setStorageSync('membershipType', normalizeMembershipType(userData.membershipType));\n\t  console.log('后端返回的数据：',userData)\n      \n      // 更新页面数据\n      userInfo.value = {\n        nickname: finalNickname,\n        avatarUrl: finalAvatarUrl,\n      };\n\t  \n\t  //登录后马上获取学生认证信息\n\t  fetchStudentInfo();\n\t  fetchUnreadMessages();\n      \n      uni.showToast({ title: '登录成功', icon: 'success' });\n    } else if (res.code === 400 && res.msg.includes('code无效')) {\n      needRelogin.value = true;\n      throw new Error('登录凭证已过期，请重新登录');\n    } else {\n      throw new Error(res.msg || '登录失败');\n    }\n  } catch (err) {\n    uni.showToast({ title: err.message, icon: 'none' });\n    console.error('登录过程出错:', err);\n  }\n};\n\n// 重新登录\nconst handleRelogin = () => {\n  needRelogin.value = false;\n  handleLogin();\n};\n\n// 导航相关方法\nconst handleSetting = () => uni.navigateTo({ url: '/pages/setting/setting' });\nconst handleAuth = () => uni.navigateTo({ url: '/pages/student/student' });\nconst handlePublish = () => {\n  if (!ensureLoggedIn({ content: '登录后才能查看我发布的商品', redirectTo: '/pages/mine/mine' })) return;\n  uni.navigateTo({ url: '/pages/publish/publish' });\n};\nconst handleSell = () => {\n  if (!ensureLoggedIn({ content: '登录后才能查看我卖出的商品', redirectTo: '/pages/mine/mine' })) return;\n  uni.navigateTo({ url: '/pages/sell/sell' });\n};\nconst handleHistory = () => {\n  if (!ensureLoggedIn({ content: '登录后才能查看历史浏览', redirectTo: '/pages/mine/mine' })) return;\n  uni.navigateTo({ url: '/pages/history/history' });\n};\nconst handleDemand = () => {\n  if (!ensureLoggedIn({ content: '登录后才能查看我的需求', redirectTo: '/pages/mine/mine' })) return;\n  uni.navigateTo({ url: '/pages/demand/demand' });\n};\nconst handleCollect = () => {\n  if (!ensureLoggedIn({ content: '登录后才能查看收藏', redirectTo: '/pages/mine/mine' })) return;\n  uni.navigateTo({ url: '/pages/collect/collect' });\n};\nconst handleMessage = () => {\n  if (!ensureLoggedIn({ content: '登录后才能查看消息', redirectTo: '/pages/mine/mine' })) return;\n  uni.navigateTo({ url: '/pages/message/message' });\n};\nconst handleGuide = () => uni.navigateTo({ url: '/pages/guide/guide' });\nconst navigateToMembership = () => uni.navigateTo({ url: '/pages/membership/membership' });\n// 点击轮播图：如果配置了 link 则跳转到对应页面，否则跳转到会员页\nconst handleBannerClick = (item) => {\n  if (item && item.link) {\n    uni.navigateTo({ url: item.link });\n  } else {\n    navigateToMembership();\n  }\n};\n\n// 其他功能\nconst handleWant = () => {\n  uni.showToast({\n    title: '其他功能正在维护中',\n    icon: 'none',\n    duration: 2000,\n    mask: true\n  });\n};\n\n// 页面卸载时清除定时器（避免内存泄漏）\nonUnmounted(() => {\n  if (unreadTimer.value) {\n    clearInterval(unreadTimer.value);\n    unreadTimer.value = null;\n  }\n});\n\n</script>\n\n<style scoped>\n/* 样式部分保持不变 */\n.user-page {\n  background-color: #f5f7fa;\n  min-height: 100vh;\n  padding: 0 30rpx;\n  overflow-x: hidden; /* 防止横向滚动偏移 */\n}\n\n.top-space {\n  height: 180rpx;\n}\n\n.header-container {\n  position: relative;\n  margin-bottom: 30rpx;\n}\n\n.header-container::before {\n  content: '';\n  position: absolute;\n  top: -200rpx;\n  right: -100rpx;\n  width: 400rpx;\n  height: 400rpx;\n  background: radial-gradient(circle, rgba(255, 98, 253, 0.2) 0%, rgba(165, 8, 255, 0.0) 70%);\n  border-radius: 50%;\n  z-index: 0;\n}\n\n.header-container::after {\n  content: '';\n  position: absolute;\n  top: -400rpx;\n  left: -300rpx;\n  width: 850rpx;\n  height: 850rpx;\n  background: radial-gradient(circle, rgba(0, 85, 255, 0.15) 0%, rgba(255, 255, 255, 0) 70%);\n  border-radius: 50%;\n  z-index: 0;\n}\n\n.user-info {\n  display: flex;\n  align-items: center;\n  padding: 20rpx 0;\n  margin-bottom: 25rpx;\n  position: relative;\n  z-index: 1;\n}\n\n.avatar {\n  width: 140rpx;\n  height: 140rpx;\n  border-radius: 50%;\n  overflow: hidden;\n  margin-right: 24rpx;\n  box-shadow: 0 6rpx 12rpx rgba(0, 0, 0, 0.1);\n  border: 4rpx solid #fff;\n}\n\n.avatar image {\n  width: 100%;\n  height: 100%;\n}\n\n.nickname-id {\n  flex: 1;\n}\n\n.nickname {\n  font-size: 36rpx;\n  font-weight: bold;\n  margin-bottom: 8rpx;\n  display: block;\n  color: #333;\n}\n\n.id {\n  font-size: 28rpx;\n  color: #666;\n}\n\n.setting-btn {\n  padding: 10rpx;\n  background-color: transparent;\n  position: relative;\n  z-index: 1;\n}\n\n.benefit-banner {\n  position: relative;\n  z-index: 1;\n}\n\n.banner-swiper {\n  height: 220rpx;\n  border-radius: 20rpx;\n  overflow: hidden;\n  box-shadow: 0 6rpx 16rpx rgba(0, 0, 0, 0.1);\n}\n\n.banner-img {\n  width: 100%;\n  height: 100%;\n}\n\n.auth-card {\n  background: linear-gradient(245deg, \n    rgba(144, 70, 227, 0.6) 0%,   /* 带透明度的浅紫 */\n    rgba(109, 7, 226, 0.3) 30%,  /* 带透明度的白色 */\n    rgba(81, 90, 254, 0.6) 100%  /* 带透明度的粉紫 */\n  );\n  border-radius: 20rpx;\n  box-shadow: 0 0 50rpx rgba(168, 142, 255, 0.2);\n  overflow: hidden;\n  position: relative;\n}\n\n.auth-content {\n  padding: 30rpx;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n}\n\n.auth-text {\n  font-size: 28rpx;\n  color: #ffffff;\n  line-height: 1.6;\n  text-align: center;\n  margin-bottom: 24rpx;\n  max-width: 500rpx;\n}\n\n.auth-button {\n  background: linear-gradient(90deg, #ff7eb3 0%, #ff5ca8 100%);\n  color: #fff;\n  border-radius: 30rpx;\n  font-size: 28rpx;\n  box-shadow: 0 4rpx 12rpx rgba(255, 92, 168, 0.3);\n}\n\n.function-buttons {\n  margin-bottom: 40rpx;\n}\n\n.button-group {\n  display: flex;\n  justify-content: space-between;\n  margin-bottom: 24rpx;\n}\n\n.function-btn {\n  flex: 1;\n  margin: 0 12rpx;\n  padding: 28rpx 10rpx;\n  padding-bottom: 0rpx;\n  font-size: 28rpx;\n  background-color: #fff;\n  border-radius: 16rpx;\n  box-shadow: 0 3rpx 8rpx rgba(0, 0, 0, 0.05);\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  transition: all 0.2s ease;\n}\n\n.function-btn:active {\n  transform: scale(0.98);\n  box-shadow: 0 2rpx 5rpx rgba(0, 0, 0, 0.03);\n}\n\n/* 1. 客服按钮容器：控制按钮位置和尺寸 */\n.contact-btn-container {\n  position: relative; /* 关键：让内部绝对定位按钮以容器为基准 */\n  width: 100%;\n  height: 80rpx; /* 与按钮高度一致，避免错位 */\n  margin-bottom: 30rpx; /* 保持与其他元素的间距 */\n}\n\n/* 2. 原微信客服按钮（底层）：隐藏默认样式，与上层按钮对齐 */\n.original-contact-btn {\n  position: absolute; /* 绝对定位，与上层按钮重叠 */\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  z-index: 1; /* 底层：确保微信客服逻辑能触发 */\n  /* 隐藏微信默认按钮样式，继承上层按钮的视觉效果 */\n  background: transparent;\n  color: transparent;\n  border: none;\n  padding: 0;\n}\n\n/* 3. 自定义客服按钮（上层）：保持原有样式，层级更高 */\n.contact-service-btn {\n  position: absolute; /* 绝对定位，覆盖底层按钮 */\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  z-index: 2; /* 上层：视觉上只显示这个按钮 */\n  /* 保留原有样式，确保视觉统一 */\n  font-size: 32rpx;\n  background: linear-gradient(90deg, #87b5ff 0%, #7c89ff 100%);\n  color: #fff;\n  border-radius: 20rpx;\n  box-shadow: 0 6rpx 16rpx rgba(51, 102, 255, 0.3);\n  transition: all 0.2s ease;\n  border: none; /* 清除默认边框 */\n}\n\n.contact-service-btn:active {\n  transform: scale(0.99);\n  box-shadow: 0 4rpx 12rpx rgba(51, 102, 255, 0.2);\n}\n\n.icon-wrapper {\n  position: relative;\n  width: 56rpx;\n  height: 56rpx;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-bottom: 14rpx;\n}\n\n.icon-wrapper.publish::before {\n    content: '';\n    position: absolute;\n    width: 160rpx; \n    height: 160rpx;\n    left: 50%;\n    top: 50%;\n    margin-left: -80rpx; \n    margin-top: -80rpx; \n    border-radius: 50%;\n    background: radial-gradient(circle, rgba(255, 165, 0, 0.2) 0%, transparent 70%);\n    z-index: 0; \n}\n\n.icon-wrapper.sell::before {\n  content: '';\n  position: absolute;\n  width: 160rpx; \n  height: 160rpx;\n  left: 50%;\n  top: 50%;\n  margin-left: -80rpx; \n  margin-top: -80rpx; \n  border-radius: 50%;\n  background: radial-gradient(circle, rgba(23, 127, 255, 0.2) 0%, transparent 70%);\n  z-index: 0;\n}\n\n.icon-wrapper.want::before {\n  content: '';\n  position: absolute;\n  width: 160rpx; \n  height: 160rpx;\n  left: 50%;\n  top: 50%;\n  margin-left: -80rpx; \n  margin-top: -80rpx; \n  border-radius: 50%;\n  background: radial-gradient(circle, rgba(0, 200, 0, 0.2) 0%, transparent 70%);\n  z-index: 0;\n}\n\n.icon-wrapper.history::before {\n  content: '';\n  position: absolute;\n  width: 160rpx; \n  height: 160rpx;\n  left: 50%;\n  top: 50%;\n  margin-left: -80rpx; \n  margin-top: -80rpx; \n  border-radius: 50%;\n  background: radial-gradient(circle, rgba(255, 57, 43, 0.2) 0%, transparent 70%);\n  z-index: 0;\n}\n\n.icon-wrapper.demand::before {\n  content: '';\n  position: absolute;\n  width: 160rpx; \n  height: 160rpx;\n  left: 50%;\n  top: 50%;\n  margin-left: -80rpx; \n  margin-top: -80rpx; \n  border-radius: 50%;\n  background: radial-gradient(circle, rgba(0, 255, 255, 0.2) 0%, transparent 70%);\n  z-index: 0;\n}\n\n.icon-wrapper.collect::before {\n  content: '';\n  position: absolute;\n  width: 160rpx; \n  height: 160rpx;\n  left: 50%;\n  top: 50%;\n  margin-left: -80rpx; \n  margin-top: -80rpx; \n  border-radius: 50%;\n  background: radial-gradient(circle, rgba(201, 106, 255, 0.2) 0%, transparent 70%);\n  z-index: 0;\n}\n\n.icon-wrapper.message::before {\n  content: '';\n  position: absolute;\n  width: 160rpx; \n  height: 160rpx;\n  left: 50%;\n  top: 50%;\n  margin-left: -80rpx; \n  margin-top: -80rpx; \n  border-radius: 50%;\n  background: radial-gradient(circle, rgba(217, 64, 255, 0.2) 0%, transparent 70%);\n  z-index: 0;\n}\n\n.icon-wrapper.guide::before {\n  content: '';\n  position: absolute;\n  width: 160rpx; \n  height: 160rpx;\n  left: 50%;\n  top: 50%;\n  margin-left: -80rpx; \n  margin-top: -80rpx; \n  border-radius: 50%;\n  background: radial-gradient(circle, rgba(255, 165, 0, 0.2) 0%, transparent 70%);\n  z-index: 0;\n}\n\n.btn-icon {\n  z-index: 1;\n  width: 100%;\n  height: 100%;\n}\n.original-contact-btn{\n  z-index: 99;\n}\n\n.icon-wrapper.message {\n  position: relative; /* 用于定位徽章 */\n}\n\n.unread-badge {\n  position: absolute;\n  top: -10rpx;\n  right: -10rpx;\n  background-color: #ff4500;\n  color: #fff;\n  font-size: 20rpx;\n  width: 32rpx;\n  height: 32rpx;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  box-shadow: 0 2rpx 4rpx rgba(0, 0, 0, 0.2);\n}\n\n.badge-text {\n  font-size: 20rpx;\n  font-weight: bold;\n}\n</style>\n","import MiniProgramPage from 'C:/Users/86133/Desktop/demo/Lezhuan/pages/mine/mine.vue'\nwx.createPage(MiniProgramPage)"],"names":["useStorage","computed","ref","onShow","onMounted","userId","chatApi","uni","userApi","ensureLoggedIn","onUnmounted"],"mappings":"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"}