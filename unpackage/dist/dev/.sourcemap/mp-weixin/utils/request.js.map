{"version":3,"file":"request.js","sources":["utils/request.js"],"sourcesContent":["export default function request(options) {\n  // 请求前拦截（添加token）\n  const token = uni.getStorageSync('token');\n  if (token) {\n    options.header = {\n      ...options.header,\n      'Authorization': `Bearer ${token}`\n    };\n  }\n\n  return new Promise((resolve, reject) => {\n    uni.request({\n      url: 'https://api.shaolezhuan.cn' + options.url, // 拼接基础地址\n      method: options.method || 'GET',\n      data: options.data,\n      header: options.header || {},\n      success: (res) => {\n        // 响应拦截（处理401 token失效或未携带token）\n        if (res.data.code === 401) {\n          // 先判断是否有token，没有的话提示请先登录\n          if (!token) {\n            uni.showToast({\n              title: '请先完成用户登录',\n              icon: 'none'\n            });\n          } else {\n            reject('登录已过期，请重新登录');\n          }\n        } else {\n          resolve(res.data);\n        }\n      },\n      fail: (err) => {\n        uni.showToast({ title: '网络错误', icon: 'none' });\n        reject(err);\n      }\n    });\n  });\n}"],"names":["uni"],"mappings":";;AAAe,SAAS,QAAQ,SAAS;AAEvC,QAAM,QAAQA,cAAAA,MAAI,eAAe,OAAO;AACxC,MAAI,OAAO;AACT,YAAQ,SAAS;AAAA,MACf,GAAG,QAAQ;AAAA,MACX,iBAAiB,UAAU,KAAK;AAAA,IACtC;AAAA,EACG;AAED,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACtCA,kBAAAA,MAAI,QAAQ;AAAA,MACV,KAAK,+BAA+B,QAAQ;AAAA;AAAA,MAC5C,QAAQ,QAAQ,UAAU;AAAA,MAC1B,MAAM,QAAQ;AAAA,MACd,QAAQ,QAAQ,UAAU,CAAE;AAAA,MAC5B,SAAS,CAAC,QAAQ;AAEhB,YAAI,IAAI,KAAK,SAAS,KAAK;AAEzB,cAAI,CAAC,OAAO;AACVA,0BAAAA,MAAI,UAAU;AAAA,cACZ,OAAO;AAAA,cACP,MAAM;AAAA,YACpB,CAAa;AAAA,UACb,OAAiB;AACL,mBAAO,aAAa;AAAA,UACrB;AAAA,QACX,OAAe;AACL,kBAAQ,IAAI,IAAI;AAAA,QACjB;AAAA,MACF;AAAA,MACD,MAAM,CAAC,QAAQ;AACbA,sBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,OAAM,CAAE;AAC7C,eAAO,GAAG;AAAA,MACX;AAAA,IACP,CAAK;AAAA,EACL,CAAG;AACH;;"}