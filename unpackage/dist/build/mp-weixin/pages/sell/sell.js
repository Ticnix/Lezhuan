"use strict";const e=require("../../common/vendor.js"),t=require("../../api/product.js");Math||(o+a)();const a=()=>"../../components/CommonGoodsList.js",o=()=>"../../node-modules/@dcloudio/uni-ui/lib/uni-icons/uni-icons.js",s={__name:"sell",setup(a){const o=e.ref(""),s=e.ref([]),u=e.ref(!1),l=e.ref(["全部种类"]),r=e.ref(["全部时间","近一周","近一个月","近三个月","更早"]),n=e.ref(0),c=e.ref(0);e.onMounted(()=>{i(),e.index.$on("pageShow",i)});const i=async()=>{try{u.value=!0;const e={current:1,size:10,status:"sold"},a=(await t.productApi.getMyGoods(e)).data.records||[];console.log("后端返回的已卖出商品数据:",a),s.value=a.map(e=>({id:e.id,title:e.title||"未命名商品",desc:e.description||"",imgUrl:e.mainImageUrl||"https://api.shaolezhuan.cn/lzphoto/productDefault.jpg",price:e.price||0,category:e.categoryName||"其他",attributes:e.attributes?JSON.parse(e.attributes):[],status:e.status||"已完成",transactionTime:e.transactionTime||"",publishTime:e.createdAt?new Date(e.createdAt).getTime():Date.now()}));const o=[...new Set(s.value.map(e=>e.category))];l.value=["全部种类",...o]}catch(a){console.error("获取已卖出商品列表失败:",a),e.index.showToast({title:"加载失败，请稍后重试",icon:"none",duration:2e3}),s.value=[]}finally{u.value=!1}},d=e.computed(()=>s.value.filter(e=>{const t=""===o.value||(e.title.toLowerCase().includes(o.value.toLowerCase())||e.desc.toLowerCase().includes(o.value.toLowerCase())),a=l.value[n.value],s="全部种类"===a||e.category===a,u=p(e.publishTime);return t&&s&&u})),p=e=>{const t=Date.now(),a=t-6048e5,o=t-2592e6,s=t-7776e6;switch(c.value){case 0:default:return!0;case 1:return e>=a;case 2:return e>=o;case 3:return e>=s;case 4:return e<s}},v=()=>{},m=e=>{n.value=e.detail.value,i()},g=e=>{c.value=e.detail.value};return e.onUnmounted(()=>{e.index.$off("pageShow",i)}),(t,a)=>e.e({a:e.p({type:"search",size:"24",color:"#999"}),b:e.o([e=>o.value=e.detail.value,v]),c:o.value,d:e.t(l.value[n.value]),e:e.p({type:"down",size:"18",color:"#999"}),f:l.value,g:n.value,h:e.o(m),i:e.t(r.value[c.value]),j:e.p({type:"down",size:"18",color:"#999"}),k:r.value,l:c.value,m:e.o(g),n:u.value},u.value?{o:e.p({type:"loading",size:"40",color:"#7c89ff",spin:!0})}:d.value.length>0?{q:e.p({goodsList:d.value,showPrice:!0,showStatus:!0})}:{r:e.p({type:"empty",size:"60",color:"#ccc"})},{p:d.value.length>0})}},u=e._export_sfc(s,[["__scopeId","data-v-09dc7b32"]]);wx.createPage(u);
