"use strict";const e=require("../../common/vendor.js"),t=require("../../api/user.js"),a=require("../../api/product.js");Math||(l+o)();const o=()=>"../../components/CommonGoodsList.js",l=()=>"../../node-modules/@dcloudio/uni-ui/lib/uni-icons/uni-icons.js",u={__name:"collect",setup(o){const l=e.ref(""),u=e.ref([]),i=e.ref(!1),n=e.ref(!1),c=e.ref([{text:"全部",value:""},{text:"出物",value:"出物"},{text:"收物",value:"收物"}]),s=e.ref([{text:"全部",value:""}]),r=e.ref(""),v=e.ref(""),p=e.ref(0),d=e.ref(0);e.onMounted(()=>{m()}),e.onShow(()=>{m()});const m=async()=>{e.index.showLoading({title:"加载中...",mask:!0});try{const l=await t.userApi.getFavoriteList();if(200!==l.code)return void e.index.showToast({title:l.msg||"获取收藏失败",icon:"none"});const n=[];for(const e of l.data)try{let t;if("product"===e.itemType)t=(await a.productApi.getProductDetail(e.itemId)).data;else{if("demand"!==e.itemType)continue;t=(await a.productApi.getDemandDetail(e.itemId)).data}const o=(t.categoryName||"其他").trim()||"其他";n.push({id:e.itemId.toString(),type:e.itemType,title:t.title||"未知标题",imgUrl:"product"===e.itemType?t.mainImageUrl||"https://api.shaolezhuan.cn/lzphoto/demandpic.png":t.mainImageUrl||"https://api.shaolezhuan.cn/lzphoto/demandDefault.jpg",price:"product"===e.itemType?t.price||0:t.budget||0,function:"product"===e.itemType?"出物":"收物",status:t.status||"normal",category:o,description:t.description||""})}catch(o){console.error(`获取${e.itemType}(${e.itemId})详情失败:`,o)}u.value=n,i.value=0===u.value.length;const c=[...new Set(u.value.map(e=>e.category).filter(e=>e&&e.trim()))].sort((e,t)=>e.localeCompare(t,"zh-CN")).map(e=>({text:e,value:e}));s.value=[{text:"全部",value:""},...c],x(!1)}catch(o){console.error("收藏加载失败:",o),e.index.showToast({title:"网络错误，请重试",icon:"none"})}finally{e.index.hideLoading()}},h=e.computed(()=>{const e=u.value.filter(e=>{const t=!r.value||e.function===r.value,a=!v.value||e.category===v.value,o=!l.value.trim()||e.title.toLowerCase().includes(l.value.toLowerCase())||e.description.toLowerCase().includes(l.value.toLowerCase());return console.log("匹配逻辑：",{selectedFunction:r.value,itemFunction:e.function,matchFunc:t}),t&&a&&o});return console.log("筛选条件：",{selectedFunction:r.value,selectedCategory:v.value,searchKeyword:l.value}),console.log("筛选结果数量：",e.length),e}),g=t=>{n.value=!0;const a=t.detail.value;p.value=a,r.value=c.value[a].value,e.nextTick$1(()=>{setTimeout(()=>n.value=!1,300)})},f=t=>{n.value=!0;const a=t.detail.value;d.value=a,v.value=s.value[a].value,e.nextTick$1(()=>{setTimeout(()=>n.value=!1,300)})};e.watch([r,v,l],()=>{const e=[...new Set(u.value.map(e=>e.category))].sort((e,t)=>e.localeCompare(t,"zh-CN")).map(e=>({text:e,value:e}));s.value=[{text:"全部",value:""},...e]},{deep:!0});const y=()=>{n.value=!0,e.nextTick$1(()=>{setTimeout(()=>n.value=!1,300)})},x=(t=!0)=>{t&&(n.value=!0),l.value="",p.value=0,d.value=0,r.value="",v.value="";const a=[...new Set(u.value.map(e=>e.category))].sort((e,t)=>e.localeCompare(t,"zh-CN")).map(e=>({text:e,value:e}));s.value=[{text:"全部",value:""},...a],t&&e.nextTick$1(()=>{setTimeout(()=>n.value=!1,300)})};return e.onUnmounted(()=>{}),(t,a)=>e.e({a:e.p({type:"search",size:"24",color:"#999"}),b:e.o([e=>l.value=e.detail.value,y]),c:l.value,d:e.t(c.value[p.value].text),e:e.p({type:"down",size:"18",color:"#999"}),f:c.value,g:p.value,h:e.o(g),i:e.t(s.value[d.value].text),j:e.p({type:"down",size:"18",color:"#999"}),k:s.value,l:d.value,m:e.o(f),n:n.value},n.value?{o:e.p({type:"loading",size:"24",color:"#fff",spin:!0})}:{},{p:!i.value&&0===h.value.length&&!n.value},i.value||0!==h.value.length||n.value?{}:{q:e.p({type:"empty",size:"60",color:"#ccc"}),r:e.o(x)},{s:!n.value},n.value?{}:{t:e.p({goodsList:h.value,showPrice:!0,showStatus:!0,emptyText:i.value?"暂无收藏商品":"",isBatchMode:!1})})}},i=e._export_sfc(u,[["__scopeId","data-v-d59cefc1"]]);wx.createPage(i);
