"use strict";const e=require("../../common/vendor.js"),a=require("../../hooks/useStorage.js");if(!Array){e.resolveComponent("uni-icons")}Math;const t={__name:"student",setup(t){const{getStorage:l}=a.useStorage(),o=e.ref(["请选择学院","文学与传媒学院","外国语学院","旅游与地理学院","生物与农业学院","数学与统计学院","智能工程学院","化学与土木工程学院","教育科学学院","信息工程学院","商学院","政法学院","音乐与舞蹈学院","美术与设计学院","体育学院","医学院","食品学院","马克思主义学院"]),u=e.ref(0),r=e.ref(!1),i=e.ref({university:"",college:"",major:"",studentIdNumber:"",idCardUrl:""}),s=e=>{u.value=e.detail.value,u.value>0?i.value.college=o.value[u.value]:i.value.college=""},n=e=>{i.value.university=e.detail.value.trim()},d=e=>{i.value.major=e.detail.value.trim()},v=e=>{i.value.studentIdNumber=e.detail.value.trim()},c=()=>{e.index.chooseImage({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:a=>{i.value.idCardUrl=a.tempFilePaths[0],e.index.showToast({title:"图片选择成功",icon:"success",duration:1500})},fail:()=>{e.index.showToast({title:"图片选择失败，请重试",icon:"none",duration:1500})}})},m=async()=>{if(!r.value)try{if(r.value=!0,!p.value)return e.index.showToast({title:"请完善所有必填信息",icon:"none"}),void(r.value=!1);const a=l("userId"),t=l("token");e.index.uploadFile({url:"https://api.shaolezhuan.cn/student-verifications/submit",filePath:i.value.idCardUrl,name:"cardPhoto",formData:{university:i.value.university,college:i.value.college,major:i.value.major,studentIdNumber:i.value.studentIdNumber,userId:a},header:{Authorization:t?`Bearer ${t}`:""},success:a=>{let t;console.log("认证提交响应：",a);try{t=JSON.parse(a.data)}catch(l){return void e.index.showToast({title:"服务器响应格式错误",icon:"none"})}200===t.code?(e.index.showToast({title:"认证提交成功，等待审核",icon:"success",duration:2e3}),setTimeout(()=>{e.index.navigateBack()},2e3)):e.index.showToast({title:t.msg||"认证提交失败",icon:"none"})},fail:a=>{console.error("认证提交失败：",a),e.index.showToast({title:"提交失败，请重试",icon:"none"})},complete:()=>{r.value=!1}})}catch(a){console.error("认证提交异常：",a),e.index.showToast({title:"提交异常，请稍后重试",icon:"none"}),r.value=!1}},p=e.computed(()=>!!(i.value.university&&i.value.college&&i.value.major&&i.value.studentIdNumber&&i.value.idCardUrl));return(a,t)=>e.e({a:e.o([e=>i.value.university=e.detail.value,n]),b:i.value.university,c:e.t(o.value[u.value]||"请选择学院"),d:o.value,e:u.value,f:e.o(s),g:e.p({type:"right",size:"22",color:"#999"}),h:e.o([e=>i.value.major=e.detail.value,d]),i:i.value.major,j:e.o([e=>i.value.studentIdNumber=e.detail.value,v]),k:i.value.studentIdNumber,l:i.value.idCardUrl||"https://api.shaolezhuan.cn/lzphoto/avatars/avatar1.jpeg",m:!i.value.idCardUrl},i.value.idCardUrl?{}:{n:e.p({type:"plus",size:"36",color:"#666"})},{o:i.value.idCardUrl},i.value.idCardUrl?{p:e.p({type:"success",size:"20",color:"#fff"})}:{},{q:e.o(c),r:r.value},r.value?{s:e.p({type:"loading",size:"24",color:"#fff"})}:{},{t:r.value},(r.value,{}),{v:e.o(m),w:!p.value||r.value})}},l=e._export_sfc(t,[["__scopeId","data-v-472d300e"]]);wx.createPage(l);